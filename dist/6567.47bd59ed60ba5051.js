"use strict";(self.webpackChunkst_admin=self.webpackChunkst_admin||[]).push([[6567],{64050:(S,M,r)=>{r.d(M,{F:()=>z}),r(38014);var v=r(3927),o=r(21086),g=r(27221),f=r(24850),x=r(26245),t=r(94650),b=r(80529),u=r(28555),C=r(91599);let z=(()=>{class Z extends v.su{constructor(c,i,p){super(c,i),this.http=c,this.store=i,this.modelName="Driver",this.baseUrl="api/drivers",this.handleError=p.createHandleError(`${this.modelName}Service`)}getDriversSimpleList(c,i){const p=(0,x.U8)(`${this.baseUrl}`,{...c,...(0,x.jq)(i)});return this.get(this.getUrl(p)).pipe((0,g.K)(()=>(0,o.of)([]))).map(_=>Array.isArray(_)?(0,v.eC)(_):(0,v.O7)(_))}getModel(c){const i=this.getUrl(`api/users/${c}`);return this.get(i).map(p=>({...p,mobile:p.mobile||{},address:p.address||{}}))}createModel(c){const i=this.getUrl("api/register");return this.post(i,c)}updateModel(c){const i=this.getUrl("api/users/");return this.put(i,c)}deleteModel(c){const i=this.getUrl(`api/users/${c}`);return this.delete(i)}searchModel(c){const i=this.getUrl(`carpark/api/drivers/filter/${c||""}`);return this.get(i).pipe((0,f.U)(p=>p.content),(0,g.K)(()=>(0,o.of)([])))}getByCode(c){const i=this.getUrl(`carpark/api/drivers/${c}`);return this.get(i).pipe((0,g.K)(()=>(0,o.of)({})))}createModelApplication(c){const i=this.getUrl(`carpark/api/drivers/${c.driverCode}/seasons/applications`);return this.post(i,c)}getSimpleList(){return this.get(this.getUrl("carpark/api/drivers/simple-drivers-list"))}getEnforcementList(){return this.get(this.getUrl("carpark/api/drivers/enforcement"))}createAccount(c,i){const p=this.getUrl("api/register");return this.post(p,{hpNumber:c,password:i})}activeAccount(c,i){const p=this.getUrl("api/account/SMS_activate");return this.post(p,{hpNumber:c,key:i})}getBatchUser(c){return this.get(this.getUrl(`carpark/api/batch/user/info?status=${c}&size=99999`))}putBatchUser(c,i,p){const _=this.getUrl("carpark/api/batch/user/info");return this.put(_,{id:c,status:i,remarks:p})}}return Z.\u0275fac=function(c){return new(c||Z)(t.LFG(b.eN),t.LFG(u.yh),t.LFG(C.k))},Z.\u0275prov=t.Yz7({token:Z,factory:Z.\u0275fac}),Z})()},73071:(S,M,r)=>{r.d(M,{K:()=>x});var h=r(3927),v=r(94650),o=r(80529),g=r(28555),f=r(91599);let x=(()=>{class t extends h.su{constructor(u,C,z){super(u,C),this.http=u,this.store=C,this.modelName="User",this.baseUrl="",this.handleError=z.createHandleError(`${this.modelName}Service`)}searchOwners(u){const C=this.getUrl("carpark/api/car-park-owners");return this.get(C)}searchOperators(u){const C=this.getUrl("carpark/api/car-park-operators");return this.get(C)}}return t.\u0275fac=function(u){return new(u||t)(v.LFG(o.eN),v.LFG(g.yh),v.LFG(f.k))},t.\u0275prov=v.Yz7({token:t,factory:t.\u0275fac}),t})()},52746:(S,M,r)=>{r.d(M,{t:()=>g});var h=r(72986),v=r(591),o=r(94650);let g=(()=>{class f{constructor(){this.loading=!1,this.pagination={totalCount:0,rowsPerPage:20,page:1,sortBy:null,descending:!0,totalPages:1},this.listData=[],this.hadGetData$=new v.X(!1)}get hadGetData(){return this.hadGetData$.getValue()}get filterParams(){return this._filterParams}set filterParams(t){this._filterParams=t}reloadDataService(t,b="filterModel"){this.loading=!0,this.hadGetData$.next(!1),t[b](this.filterParams,this.pagination).pipe((0,h.q)(1)).subscribe(u=>{if(u.pagination.page>u.pagination.totalPages)return this.pagination={...this.pagination,page:u.pagination.totalPages},this.reloadDataService(t);this.loading=!1,this.pagination={...this.pagination,totalCount:u.pagination.totalCount||u.pagination.totalElements},this.listData=u.data,this.hadGetData$.next(!0)},()=>{this.loading=!1,this.listData=[],this.pagination={...this.pagination,totalCount:0}})}onQueryParamsChange(t){const{pageSize:b,pageIndex:u}=t;this.pagination={...this.pagination,rowsPerPage:b,page:u},this.reloadData()}reloadData(){}ngOnInit(){}}return f.\u0275fac=function(t){return new(t||f)},f.\u0275cmp=o.Xpm({type:f,selectors:[["ng-component"]],decls:0,vars:0,template:function(t,b){},encapsulation:2}),f})()},76916:(S,M,r)=>{r.d(M,{G:()=>Z});var h=r(34793),v=r(92198),o=r(94650),g=r(89383),f=r(60097),x=r(36895);function t(m,c){if(1&m&&(o.TgZ(0,"a",14)(1,"span",15),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&m){const i=o.oxw().$implicit;o.xp6(2),o.hij(" ",o.lcZ(3,1,i.label)," ")}}function b(m,c){if(1&m&&(o.TgZ(0,"a",16)(1,"span",15),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&m){const i=o.oxw(),p=i.$implicit,_=i.last,B=o.oxw(2);o.Q6J("routerLink",p.url)("queryParams",_&&B.route.snapshot.queryParams),o.xp6(2),o.hij(" ",o.lcZ(3,3,p.label)," ")}}function u(m,c){if(1&m&&(o.ynx(0),o.TgZ(1,"li",10)(2,"span"),o._uU(3," > "),o.qZA()(),o.TgZ(4,"li",11),o.YNc(5,t,4,3,"a",12),o.YNc(6,b,4,5,"a",13),o.qZA(),o.BQk()),2&m){const i=c.first;o.xp6(5),o.Q6J("ngIf",i),o.xp6(1),o.Q6J("ngIf",!i)}}function C(m,c){if(1&m&&(o.TgZ(0,"div",1)(1,"div",2)(2,"div",3),o._UZ(3,"h3",4),o.TgZ(4,"ul",5)(5,"li",6)(6,"a",7),o._UZ(7,"i",8),o.qZA()(),o.YNc(8,u,7,2,"ng-container",9),o.qZA()(),o.TgZ(9,"div"),o.Hsn(10),o.qZA()()()),2&m){const i=o.oxw();o.xp6(3),o.Q6J("innerHTML",i.title,o.oJD),o.xp6(5),o.Q6J("ngForOf",i.breads)}}const z=["*"];let Z=(()=>{class m{constructor(i,p,_,B){this.router=i,this.route=p,this.translate=_,this._carparkService=B,this.breads=[],this.loginUser=""}ngOnInit(){let i=JSON.parse(localStorage.getItem("user-roles"))[0];this.loginUser=i,console.log(this.loginUser,"\u4fe1\u606f"),this.breads=this.buildBreadCrumb(this.route.root),this.translate.get(this.breads[0].label).subscribe(_=>{this.label=_}),this.router.events.pipe((0,v.h)(_=>_ instanceof h.m2)).subscribe(()=>{this.breads=this.buildBreadCrumb(this.route.root)})}buildBreadCrumb(i,p=[""],_=[]){const B=i.snapshot.url[0]&&i.snapshot.url[0].path,E=[...p,B],D={...this.extractBreadcrumb(i),url:E},F=B&&D.label?[..._,D]:_;return this.title=D.title||this.title||"",this.isMotorist&&"My Vehicle(s)"===D.label&&(this.title="My Vehicle(s)"),i.firstChild?B?this.buildBreadCrumb(i.firstChild,E,F):this.buildBreadCrumb(i.firstChild,p,_):(this.translate.get(this.title).subscribe(N=>{this.title=N}),F)}get isMotorist(){return this._carparkService.isMotorist()}extractBreadcrumb(i){return i.snapshot.data.breadcrumb instanceof Function?i.snapshot.data.breadcrumb(i):i.snapshot.data.breadcrumb}}return m.\u0275fac=function(i){return new(i||m)(o.Y36(h.F0),o.Y36(h.gz),o.Y36(g.sK),o.Y36(f.x))},m.\u0275cmp=o.Xpm({type:m,selectors:[["app-title-bar"]],ngContentSelectors:z,decls:1,vars:1,consts:[["class","m-subheader",4,"ngIf"],[1,"m-subheader"],[1,"d-flex","align-items-center"],[1,"mr-auto"],[1,"m-subheader__title","m-subheader__title--separator","text-main",3,"innerHTML"],[1,"m-subheader__breadcrumbs","m-nav","m-nav--inline"],[1,"m-nav__item","m-nav__item--home"],["routerLink","/",1,"m-nav__link","m-nav__link--icon"],[1,"m-nav__link-icon","la","la-home"],[4,"ngFor","ngForOf"],[1,"m-nav__separator"],[1,"m-nav__item"],["class","m-nav__link",4,"ngIf"],["class","m-nav__link",3,"routerLink","queryParams",4,"ngIf"],[1,"m-nav__link"],[1,"m-nav__link-text"],[1,"m-nav__link",3,"routerLink","queryParams"]],template:function(i,p){1&i&&(o.F$t(),o.YNc(0,C,11,2,"div",0)),2&i&&o.Q6J("ngIf","ROLE_TPO_PARTNER"!==p.loginUser)},dependencies:[x.sg,x.O5,h.yS,g.X$],encapsulation:2}),m})()},26567:(S,M,r)=>{r.r(M),r.d(M,{BroadcastModule:()=>Zt,createTranslateLoader:()=>q});var h=r(36895),v=r(80529),o=r(24006),g=r(34793),f=r(372),x=r(72986),t=r(94650),b=r(26245),u=r(3927),C=r(27221),z=r(28555),Z=r(91599);let m=(()=>{class a extends u.su{constructor(e,n,s){super(e,n),this.http=e,this.store=n,this.modelName="Broadcast",this.handleError=s.createHandleError(`${this.modelName}Service`)}filterModel(e,n){const s=this.getUrl((0,b.U8)("carpark/api/broadcast-messagings/get-messages",{...e,...(0,b.jq)(n)}));return this.get(s).pipe((0,C.K)(this.handleError(`${this.modelName}Filter`,{}))).map(l=>Array.isArray(l)?(0,u.eC)(l):(0,u.O7)(l))}createModel(e,n){let s="";return s=this.getUrl("Individual"==n.type?`carpark/api/broadcast-messagings/${e}`:"All"==n.type?"carpark/api/bulksend-broadcast-messages":"carpark/api/season-broadcast-messages"),this.post(s,n).pipe((0,C.K)(this.handleError(`${this.modelName}Create`,{})))}approve(e){return this.get(this.getUrl(`carpark/api/broadcast-messagings/${e}/approve`))}getModel(e){const n=this.getUrl(`carpark/api/broadcast-messagings/${e}`);return this.get(n)}updateModel(e){const n=this.getUrl("carpark/api/broadcast-messagings");return this.put(n,e)}deleteModel(e){const n=this.getUrl(`carpark/api/broadcast-messagings/${e}`);return this.delete(n)}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(v.eN),t.LFG(z.yh),t.LFG(Z.k))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})(),c=(()=>{class a{constructor(e,n){this.broadcastService=e,this.router=n}resolve(e){return this.broadcastService.getModel(e.paramMap.get("login")).pipe((0,x.q)(1))}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(m),t.LFG(g.F0))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})();var i=r(42684),p=r(64050),_=r(30329),B=r(59501),E=r(59245),D=r(21532),F=r(73071),N=r(88796),A=r(89383),Y=r(19832);function V(a){return new Y.w(a,"../assets/i18n/",".json")}let X=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[Z.k,i.e,F.K,p.F],imports:[g.Bz,h.ez,D.x,o.u5,_.D,E.mr,f.kn,N.A0,A.aw.forChild({loader:{provide:A.Zw,useFactory:V,deps:[v.eN]}})]}),a})();var tt=r(15439),O=r(70853),J=r(76916),L=r(38014),j=r(8929),Q=r(35635),K=r(66616),$=r(47044),w=r(21811),R=r(38231),H=r(48521);function et(a,d){if(1&a&&(t.TgZ(0,"div",25)(1,"div",26)(2,"div",27)(3,"h3",28),t._uU(4),t.ALo(5,"translate"),t.qZA()()()()),2&a){const e=t.oxw();t.xp6(4),t.AsE(" ",t.lcZ(5,2,"BroadCast ID"),": ",e.form.id," ")}}function at(a,d){if(1&a&&(t.TgZ(0,"label",29),t._uU(1),t.qZA()),2&a){const e=d.$implicit;t.Q6J("nzValue",e.text),t.xp6(1),t.Oqu(e.text)}}function nt(a,d){1&a&&t._UZ(0,"i",36)}function ot(a,d){1&a&&(t.TgZ(0,"div",37),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Field is required.")," "))}function rt(a,d){if(1&a){const e=t.EpF();t.TgZ(0,"div",4)(1,"label",5)(2,"span",6),t._uU(3,"*"),t.qZA(),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",11)(7,"div",30)(8,"input",31,32),t.NdJ("ngModelChange",function(s){t.CHM(e);const l=t.oxw();return t.KtG(l.mobileNo=s)})("ngModelChange",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.validateDriver(s.mobileNo))}),t.qZA(),t.TgZ(10,"span",33)(11,"span"),t.YNc(12,nt,1,0,"i",34),t.qZA()()(),t.YNc(13,ot,3,3,"div",35),t.qZA()()}if(2&a){const e=t.MAs(9),n=t.oxw();t.xp6(4),t.hij(" ",t.lcZ(5,4,"Broadcast To"),": "),t.xp6(4),t.Q6J("ngModel",n.mobileNo),t.xp6(4),t.Q6J("ngIf",n.visiable),t.xp6(1),t.Q6J("ngIf",e.invalid&&(e.dirty||e.touched))}}function st(a,d){1&a&&(t.TgZ(0,"div",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Field is required.")," "))}function it(a,d){1&a&&(t.TgZ(0,"div",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Field is required.")," "))}function lt(a,d){1&a&&(t.TgZ(0,"div",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Field is required.")," "))}let k=(()=>{class a{constructor(e,n,s,l,T){this.router=e,this.driverService=n,this.broadcastService=s,this.translate=l,this.busService=T,this.canceled=new t.vpe,this.submitted=new t.vpe,this.form=(0,L.o4S)(),this.identityTypeOptions=L.KiP,this.driverInput$=new j.xQ,this.selectBroadCastType="Individual",this.visiable=!1,this.broadCastType=[{text:"All"},{text:"Season"},{text:"Individual"}],this.busAdminBroadCastType=[{text:"Individual"}]}ngOnInit(){this.form=this.form||(0,L.o4S)(),this.busService.isBusAdmin()&&(this.broadCastType=this.busAdminBroadCastType)}cancel(){this.canceled.emit()}submit(){let e="Individual"!==this.selectBroadCastType;e&&(this.driver=null),this.submitted.emit({...this.form,driverCode:this.driver?this.driver.userName:"",driver:e?{}:this.driver,type:this.selectBroadCastType})}displayDriverOption(e){return[[e.firstName,e.lastName].filter(s=>s).join(" "),e.mobile,e.email].filter(s=>s&&s.length).join(", ")}changeBroadCastType(e){this.selectBroadCastType=e}validateDriver(e){this.visiable=!1,this.driver=null,e.length>=8&&this.driverService.searchModel(e).subscribe(n=>{n.length&&(this.visiable=!0,this.driver=n[0])})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(g.F0),t.Y36(p.F),t.Y36(m),t.Y36(A.sK),t.Y36(O.Z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-broadcast-form"]],inputs:{form:"form",item:"item"},outputs:{canceled:"canceled",submitted:"submitted"},decls:55,vars:29,consts:[[1,"m-form","m-form--fit","m-form--label-align-right"],[1,"m-portlet"],["class","m-portlet__head",4,"ngIf"],[1,"m-portlet__body"],[1,"row","form-group","m-form__group"],[1,"col-form-label","col-lg-2","col-sm-12"],[1,"m--font-danger"],[1,"col-lg-6","col-sm-12","d-flex","align-items-center"],["name","type",3,"ngModel","ngModelChange"],["nz-radio","",3,"nzValue",4,"ngFor","ngForOf"],["class","row form-group m-form__group",4,"ngIf"],[1,"col-lg-4","col-sm-12"],["nzPlaceHolder","Please Select",2,"width","100%",3,"name","ngModel","ngModelChange"],["message_type","ngModel"],["nzValue","Announcement","nzLabel","Announcement"],["nzValue","Promotion","nzLabel","Promotion"],["class","form-control-feedback",4,"ngIf"],["nz-input","","type","text","name","message_subject","placeholder","Message Subject","required","",3,"ngModel","ngModelChange"],["message_subject","ngModel"],["nz-input","","name","message_content","placeholder","Message Content","required","","rows","5","cols","33",3,"ngModel","ngModelChange"],["message_content","ngModel"],[1,"m-portlet__foot","bg-light-gray"],[1,"m-form__actions","m-form__actions--right"],["nz-button","","nzType","primary","nzSize","large","nzGhost","",1,"btn-form-ops",3,"click"],["nz-button","","nzType","primary","nzSize","large",1,"btn-form-ops","m--margin-left-30",3,"click"],[1,"m-portlet__head"],[1,"m-portlet__head-caption"],[1,"m-portlet__head-title"],[1,"m-portlet__head-text"],["nz-radio","",3,"nzValue"],[1,"m-input-icon","m-input-icon--right"],["nz-input","","type","text","name","driverControl","placeholder","Broadcast To","required","",3,"ngModel","ngModelChange"],["driver","ngModel"],[1,"m-input-icon__icon","m-input-icon__icon--right"],["class","fa fa-check",4,"ngIf"],["class","form-control-feedback","style","color: #f4516c;",4,"ngIf"],[1,"fa","fa-check"],[1,"form-control-feedback",2,"color","#f4516c"],[1,"form-control-feedback"]],template:function(e,n){if(1&e&&(t.TgZ(0,"form",0)(1,"div",1),t.YNc(2,et,6,4,"div",2),t.TgZ(3,"div",3)(4,"div",4)(5,"label",5)(6,"span",6),t._uU(7,"*"),t.qZA(),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"div",7)(11,"nz-radio-group",8),t.NdJ("ngModelChange",function(l){return n.selectBroadCastType=l}),t.YNc(12,at,2,2,"label",9),t.qZA()()(),t.YNc(13,rt,14,6,"div",10),t.TgZ(14,"div",4)(15,"label",5)(16,"span",6),t._uU(17,"*"),t.qZA(),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"div",11)(21,"nz-select",12,13),t.NdJ("ngModelChange",function(l){return n.form.message_type=l}),t._UZ(23,"nz-option",14)(24,"nz-option",15),t.qZA(),t.YNc(25,st,3,3,"div",16),t.qZA()(),t.TgZ(26,"div",4)(27,"label",5)(28,"span",6),t._uU(29,"*"),t.qZA(),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"div",11)(33,"input",17,18),t.NdJ("ngModelChange",function(l){return n.form.message_subject=l}),t.qZA(),t.YNc(35,it,3,3,"div",16),t.qZA()(),t.TgZ(36,"div",4)(37,"label",5)(38,"span",6),t._uU(39,"*"),t.qZA(),t._uU(40),t.ALo(41,"translate"),t.qZA(),t.TgZ(42,"div",11)(43,"textarea",19,20),t.NdJ("ngModelChange",function(l){return n.form.message_content=l}),t._uU(45,"          "),t.qZA(),t.YNc(46,lt,3,3,"div",16),t.qZA()()(),t.TgZ(47,"div",21)(48,"div",22)(49,"button",23),t.NdJ("click",function(){return n.cancel()}),t._uU(50),t.ALo(51,"translate"),t.qZA(),t.TgZ(52,"button",24),t.NdJ("click",function(){return n.submit()}),t._uU(53),t.ALo(54,"translate"),t.qZA()()()()()),2&e){const s=t.MAs(22),l=t.MAs(34),T=t.MAs(44);t.xp6(2),t.Q6J("ngIf",n.form),t.xp6(6),t.hij(" ",t.lcZ(9,17,"BroadCast Type"),": "),t.xp6(3),t.Q6J("ngModel",n.selectBroadCastType),t.xp6(1),t.Q6J("ngForOf",n.broadCastType),t.xp6(1),t.Q6J("ngIf","Individual"===n.selectBroadCastType),t.xp6(5),t.hij(" ",t.lcZ(19,19,"Message Type"),": "),t.xp6(3),t.MGl("name","message_type",n.i,""),t.Q6J("ngModel",n.form.message_type),t.xp6(4),t.Q6J("ngIf",s.invalid&&(s.dirty||s.touched)),t.xp6(5),t.hij(" ",t.lcZ(31,21,"Message Subject"),": "),t.xp6(3),t.Q6J("ngModel",n.form.message_subject),t.xp6(2),t.Q6J("ngIf",l.invalid&&(l.dirty||l.touched)),t.xp6(5),t.hij(" ",t.lcZ(41,23,"Message Content"),": "),t.xp6(3),t.Q6J("ngModel",n.form.message_content),t.xp6(3),t.Q6J("ngIf",T.invalid&&(T.dirty||T.touched)),t.xp6(4),t.hij(" ",t.lcZ(51,25,"Cancel")," "),t.xp6(3),t.hij(" ",t.lcZ(54,27,"Submit")," ")}},dependencies:[h.sg,h.O5,Q.Zp,K.ix,$.w,w.dQ,R.Ip,R.Vq,H.Of,H.Dg,o._Y,o.Fj,o.JJ,o.JL,o.Q7,o.On,o.F,A.X$],encapsulation:2}),a})(),ct=(()=>{class a{constructor(e,n,s,l){this.router=e,this.broadcastService=n,this.translate=s,this.busService=l}ngOnInit(){}cancel(){this.router.navigate([this.busService.isBusAdmin()?"/bus-broadcast":"/broadcast"])}submit(e){let{message_content:n,message_subject:s,message_type:l,driverCode:T,id:U,type:I}=e;const P={approvalDateTime:"",approvedBy:"",createdBy:"",createdDateTime:tt().format("YYYY-MM-DDTHH:mm:ssZ"),driverCode:T,id:U,messageContent:n,messageSubject:s,messageType:l,status:"",type:I};this.broadcastService.createModel(e.driverCode,"Individual"!==e.type?P:e).subscribe(()=>{this.cancel()})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(g.F0),t.Y36(m),t.Y36(A.sK),t.Y36(O.Z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-broadcast-create"]],decls:4,vars:0,consts:[[1,"body-wrapper"],[1,"m-content"],[3,"canceled","submitted"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-title-bar"),t.TgZ(2,"div",1)(3,"app-broadcast-form",2),t.NdJ("canceled",function(){return n.cancel()})("submitted",function(l){return n.submit(l)}),t.qZA()()())},dependencies:[J.G,k],encapsulation:2}),a})();r(79118);var dt=r(52746),pt=r(47423),G=r(73325),W=r(29562),y=r(40269);function mt(a,d){if(1&a){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.gotoCreate())}),t._UZ(1,"span",16),t._uU(2,"Create Broadcast "),t.qZA()}}function ut(a,d){if(1&a&&t._uU(0),2&a){const e=d.range;t.lnq(" ",e[0],"-",e[1]," of ",d.$implicit," items ")}}function gt(a,d){if(1&a&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&a){const e=d.$implicit;t.xp6(1),t.Oqu(e.text)}}function _t(a,d){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",21),t._UZ(2,"i",22),t.qZA(),t.TgZ(3,"nz-dropdown-menu",null,23)(5,"ul",24)(6,"li",25),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2).$implicit,l=t.oxw();return t.KtG(l.gotoUpdate(s.id))}),t._UZ(7,"i",26),t.TgZ(8,"span"),t._uU(9),t.ALo(10,"translate"),t.qZA()(),t.TgZ(11,"li",25),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2).$implicit,l=t.oxw();return t.KtG(l.approve(s.id))}),t._UZ(12,"i",27),t.TgZ(13,"span"),t._uU(14),t.ALo(15,"translate"),t.qZA()()()(),t.BQk()}if(2&a){const e=t.MAs(4);t.xp6(1),t.Q6J("nzDropdownMenu",e)("nzPlacement","topCenter"),t.xp6(8),t.Oqu(t.lcZ(10,4,"Edit Message")),t.xp6(5),t.Oqu(t.lcZ(15,6,"Approve"))}}function ht(a,d){if(1&a&&(t.ynx(0),t.YNc(1,_t,16,8,"ng-container",18),t.BQk()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf","Pending"===e.status)}}function vt(a,d){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr")(2,"td",17),t.NdJ("nzExpandChange",function(s){const T=t.CHM(e).$implicit,U=t.oxw();return t.KtG(U.onExpandChange(T.id,s))}),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"date"),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.TgZ(14,"td"),t.YNc(15,ht,2,1,"ng-container",18),t.qZA()(),t.TgZ(16,"tr",19)(17,"nz-table",20)(18,"thead")(19,"tr")(20,"th"),t._uU(21),t.ALo(22,"translate"),t.qZA()()(),t.TgZ(23,"tbody")(24,"tr")(25,"td"),t._uU(26),t.qZA()()()()(),t.BQk()}if(2&a){const e=d.$implicit,n=d.index,s=t.oxw();t.xp6(1),t.ekj("ant-table-row-odd",n%2==1),t.xp6(1),t.Q6J("nzExpand",s.expandSet.has(e.id)),t.xp6(2),t.Oqu(e.id),t.xp6(2),t.hij("",s.displayName(e)," "),t.xp6(2),t.Oqu(t.xi3(9,13,e.created_datetime,"d LLL yyyy")),t.xp6(3),t.Oqu(e.message_subject),t.xp6(2),t.Oqu(e.approved_by),t.xp6(2),t.Q6J("ngIf","ROLE_CPO_USER"!==s.loginRole),t.xp6(1),t.Q6J("nzExpand",s.expandSet.has(e.id)),t.xp6(1),t.Q6J("nzShowPagination",!1),t.xp6(4),t.Oqu(t.lcZ(22,16,"Message Content")),t.xp6(5),t.hij(" ",e.message_content||"-"," ")}}let ft=(()=>{class a extends dt.t{constructor(e,n,s,l){super(),this.router=e,this.broadcastService=n,this.translate=s,this.busService=l,this.data=[],this.pagination=(0,b.f$)(),this.keyword="",this.keyword$=new j.xQ,this.tableHeaders=[{text:"ID",column:"id",width:"50px"},{text:"Broadcast To",column:"driverId",width:"150px"},{text:"Created Date",column:"created_date",width:"150px"},{text:"Subject",column:"message_subject",width:"150px"},{text:"Approve",column:"status",width:"80px"},{text:"Actions",width:"80px"}],this.loginRole="",this.approving={},this.expandSet=new Set;const T=this.tableHeaders.map(U=>U.text);this.translate.get(T).subscribe(U=>{this.tableHeaders.forEach(I=>{for(let P in U)U.hasOwnProperty(P)&&I.text===P&&(I.text=U[P])})})}gotoCreate(){this.router.navigate([this.busService.isBusAdmin()?"/bus-broadcast/create":"/broadcast/create"])}gotoUpdate(e){this.router.navigate([this.busService.isBusAdmin()?`/bus-broadcast/${e}/update`:`/broadcast/${e}/update`])}get filterParams(){return{key:this.keyword,sort:"id,desc"}}reloadData(){this.reloadDataService(this.broadcastService)}pageChanged(e){this.pagination=e,this.reloadData()}displayName(e){return e?(0,L.ssW)(e):""}approve(e){this.approving[e]=!0,this.broadcastService.approve(e).subscribe(()=>this.reloadData(),null,()=>this.approving[e]=!1)}ngOnInit(){this.keyword$.debounceTime(500).subscribe(()=>{this.reloadData()}),this.reloadData(),this.loginRole=JSON.parse(localStorage.getItem("user-roles"))[0]}onExpandChange(e,n){n?this.expandSet.add(e):this.expandSet.delete(e)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(g.F0),t.Y36(m),t.Y36(A.sK),t.Y36(O.Z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-broadcast-home"]],features:[t.qOj],decls:23,vars:12,consts:[[1,"body-wrapper"],["nz-button","","nzType","primary","nzShape","round","nzSize","large",3,"click",4,"ngIf"],[1,"m-content"],[1,"m-portlet","m-portlet--bordered-semi","m--padding-top-40"],[1,"m-portlet__body"],[1,"row","form-group","m-form__group"],[1,"col-form-label"],[1,"col-lg-3"],[1,"m-input-icon","m-input-icon--left"],["type","text","nz-input","","placeholder","Message Subject",3,"ngModel","ngModelChange"],["rangeTemplate",""],[3,"nzData","nzFrontPagination","nzLoading","nzTotal","nzPageSize","nzPageIndex","nzShowSizeChanger","nzShowTotal","nzQueryParams"],["basicTable",""],["nzWidth","60px"],[4,"ngFor","ngForOf"],["nz-button","","nzType","primary","nzShape","round","nzSize","large",3,"click"],["nz-icon","","nzType","plus","nzTheme","outline"],[3,"nzExpand","nzExpandChange"],[4,"ngIf"],[3,"nzExpand"],["nzSize","small","nzTemplateMode","",3,"nzShowPagination"],["nz-dropdown","","nzTrigger","click",1,"btn","btn-outline-primary","m-btn","m-btn--icon","m-btn--icon-only","m-btn--custom","m-btn--outline-2x","m-btn--pill","no-border",3,"nzDropdownMenu","nzPlacement"],[1,"la","la-ellipsis-h"],["menu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"],[1,"la","la-edit",2,"margin-right","4px"],[1,"la","la-check",2,"margin-right","4px"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"app-title-bar"),t.YNc(2,mt,3,0,"button",1),t.qZA(),t.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"label",6),t._uU(8," Message Subject: "),t.qZA(),t.TgZ(9,"div",7)(10,"div",8)(11,"input",9),t.NdJ("ngModelChange",function(l){return n.keyword=l})("ngModelChange",function(l){return n.keyword$.next(l)}),t.qZA()()()(),t.YNc(12,ut,1,3,"ng-template",null,10,t.W1O),t.TgZ(14,"nz-table",11,12),t.NdJ("nzQueryParams",function(l){return n.onQueryParamsChange(l)}),t.TgZ(16,"thead")(17,"tr")(18,"th",13),t._uU(19,"#"),t.qZA(),t.YNc(20,gt,2,1,"th",14),t.qZA()(),t.TgZ(21,"tbody"),t.YNc(22,vt,27,18,"ng-container",14),t.qZA()()()()()()),2&e){const s=t.MAs(13),l=t.MAs(15);t.xp6(2),t.Q6J("ngIf","ROLE_CPO_USER"!==n.loginRole),t.xp6(9),t.Q6J("ngModel",n.keyword),t.xp6(3),t.Q6J("nzData",n.listData)("nzFrontPagination",!1)("nzLoading",n.loading)("nzTotal",n.pagination.totalCount)("nzPageSize",n.pagination.rowsPerPage)("nzPageIndex",n.pagination.page)("nzShowSizeChanger",!0)("nzShowTotal",s),t.xp6(6),t.Q6J("ngForOf",n.tableHeaders),t.xp6(2),t.Q6J("ngForOf",l.data)}},dependencies:[h.sg,h.O5,o.Fj,o.JJ,o.On,J.G,Q.Zp,pt.Ls,G.wO,G.r9,W.cm,W.RR,K.ix,$.w,w.dQ,y.N8,y.Uo,y._C,y.h7,y.Om,y.p0,y.$Z,y.d3,y.Vk,h.uU,A.X$],encapsulation:2}),a})();function bt(a,d){if(1&a){const e=t.EpF();t.TgZ(0,"ul",7)(1,"li",8)(2,"a",9),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.delete())}),t._UZ(3,"i",10),t.TgZ(4,"span"),t._uU(5,"Delete Message"),t.qZA()()()()}}let Ct=(()=>{class a{constructor(e,n,s,l,T){this.router=e,this.route=n,this.broadcastService=s,this.translate=l,this.busService=T}ngOnInit(){this.item=this.route.snapshot.data.broadcast}delete(){this.broadcastService.deleteModel(this.item.id).subscribe(()=>{this.cancel()})}cancel(){this.router.navigate([this.busService.isBusAdmin()?"/bus-broadcast":"/broadcast"])}submit(e){this.broadcastService.updateModel(e).subscribe(()=>{this.cancel()})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(g.F0),t.Y36(g.gz),t.Y36(m),t.Y36(A.sK),t.Y36(O.Z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-broadcast-update"]],decls:8,vars:1,consts:[[1,"body-wrapper"],["dropdown","",1,"m-dropdown","m-dropdown--inline"],["dropdownToggle","",1,"btn","btn-outline-main","m-btn","m-btn--icon","m-btn--icon-only","m-btn--custom","m-btn--pill","m-btn--air"],[1,"la","la-ellipsis-h"],["class","dropdown-menu dropdown-menu-right","role","menu",4,"dropdownMenu"],[1,"m-content"],[3,"form","canceled","submitted"],["role","menu",1,"dropdown-menu","dropdown-menu-right"],["role","menuitem"],[1,"dropdown-item",3,"click"],[1,"la","la-trash"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"app-title-bar")(2,"div",1)(3,"button",2),t._UZ(4,"i",3),t.qZA(),t.YNc(5,bt,6,0,"ul",4),t.qZA()(),t.TgZ(6,"div",5)(7,"app-broadcast-form",6),t.NdJ("canceled",function(){return n.cancel()})("submitted",function(l){return n.submit(l)}),t.qZA()()()),2&e&&(t.xp6(7),t.Q6J("form",n.item))},dependencies:[J.G,E.Hz,E.Mq,E.TO,k],encapsulation:2}),a})();var Tt=r(60097);function q(a){return new Y.w(a,"../assets/i18n/",".json")}const xt=[{path:"",component:B.f,children:[{path:"",component:ft},{path:"create",component:ct,data:{breadcrumb:{label:"Create"}}},{path:":login/update",resolve:{broadcast:c},component:Ct}]}];let Zt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[Z.k,i.e,m,c,p.F,Tt.x,O.Z],imports:[h.ez,o.u5,g.Bz.forChild(xt),D.x,_.D,E.mr,f.kn,X,A.aw.forChild({loader:{provide:A.Zw,useFactory:q,deps:[v.eN]}}),g.Bz]}),a})()}}]);