"use strict";(self.webpackChunkst_admin=self.webpackChunkst_admin||[]).push([[7223],{76284:(L,T,o)=>{o.d(T,{z:()=>_});var c=o(3927),g=o(94650),h=o(80529),s=o(28555),P=o(11481),e=o(91599);let _=(()=>{class f extends c.su{constructor(m,x,z,M){super(m,x),this.http=m,this.store=x,this.sanitizer=z,this.modelName="User",this.baseUrl="",this.handleError=M.createHandleError(`${this.modelName}Service`)}uploadImage(m){const x=this.getUrl("carpark/api/assets/img"),z=new FormData;return z.append("file",m,m.name),this.post(x,z).map(({uuid:M})=>this.getImage(M))}getImage(m){return this.getUrl(`carpark/api/resources/${m}`)}getImageByUuid(m,x){return this.get(this.getUrl(`carpark/api/resources/${m}`),{responseType:"blob"}).map(z=>x?this._getSafeFileUrl(z):this.getSafeFileUrl(z))}getSafeFileUrl(m){return this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(m))}_getSafeFileUrl(m){return{imgUrl:this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(m)),type:m.type}}requestSessionImage(m,x){const z=this.getUrl(`carpark/api/anpr/request/${m}/${x}`);return this.get(z,{responseType:"text"})}getSessionImage(m){return this.get(this.getUrl(`carpark/api/anpr/assets/${m}/1`),{responseType:"blob"}).map(x=>this.getSafeFileUrl(x))}}return f.\u0275fac=function(m){return new(m||f)(g.LFG(h.eN),g.LFG(s.yh),g.LFG(P.H7),g.LFG(e.k))},f.\u0275prov=g.Yz7({token:f,factory:f.\u0275fac}),f})()},52746:(L,T,o)=>{o.d(T,{t:()=>s});var c=o(72986),g=o(591),h=o(94650);let s=(()=>{class P{constructor(){this.loading=!1,this.pagination={totalCount:0,rowsPerPage:20,page:1,sortBy:null,descending:!0,totalPages:1},this.listData=[],this.hadGetData$=new g.X(!1)}get hadGetData(){return this.hadGetData$.getValue()}get filterParams(){return this._filterParams}set filterParams(_){this._filterParams=_}reloadDataService(_,f="filterModel"){this.loading=!0,this.hadGetData$.next(!1),_[f](this.filterParams,this.pagination).pipe((0,c.q)(1)).subscribe(y=>{if(y.pagination.page>y.pagination.totalPages)return this.pagination={...this.pagination,page:y.pagination.totalPages},this.reloadDataService(_);this.loading=!1,this.pagination={...this.pagination,totalCount:y.pagination.totalCount||y.pagination.totalElements},this.listData=y.data,this.hadGetData$.next(!0)},()=>{this.loading=!1,this.listData=[],this.pagination={...this.pagination,totalCount:0}})}onQueryParamsChange(_){const{pageSize:f,pageIndex:y}=_;this.pagination={...this.pagination,rowsPerPage:f,page:y},this.reloadData()}reloadData(){}ngOnInit(){}}return P.\u0275fac=function(_){return new(_||P)},P.\u0275cmp=h.Xpm({type:P,selectors:[["ng-component"]],decls:0,vars:0,template:function(_,f){},encapsulation:2}),P})()},76916:(L,T,o)=>{o.d(T,{G:()=>M});var c=o(34793),g=o(92198),h=o(38014),s=o(94650),P=o(89383),e=o(60097),_=o(36895);function f(p,k){if(1&p&&(s.TgZ(0,"a",14)(1,"span",15),s._uU(2),s.ALo(3,"translate"),s.qZA()()),2&p){const d=s.oxw().$implicit;s.xp6(2),s.hij(" ",s.lcZ(3,1,d.label)," ")}}function y(p,k){if(1&p&&(s.TgZ(0,"a",16)(1,"span",15),s._uU(2),s.ALo(3,"translate"),s.qZA()()),2&p){const d=s.oxw(),v=d.$implicit,b=d.last,Z=s.oxw(2);s.Q6J("routerLink",v.url)("queryParams",b&&Z.route.snapshot.queryParams),s.xp6(2),s.hij(" ",s.lcZ(3,3,v.label)," ")}}function m(p,k){if(1&p&&(s.ynx(0),s.TgZ(1,"li",10)(2,"span"),s._uU(3," > "),s.qZA()(),s.TgZ(4,"li",11),s.YNc(5,f,4,3,"a",12),s.YNc(6,y,4,5,"a",13),s.qZA(),s.BQk()),2&p){const d=k.first;s.xp6(5),s.Q6J("ngIf",d),s.xp6(1),s.Q6J("ngIf",!d)}}function x(p,k){if(1&p){const d=s.EpF();s.TgZ(0,"div",1)(1,"div",2)(2,"div",3),s._UZ(3,"h3",4),s.TgZ(4,"ul",5)(5,"li",6)(6,"a",7),s.NdJ("click",function(){s.CHM(d);const b=s.oxw();return s.KtG(b.jumpHome())}),s._UZ(7,"i",8),s.qZA()(),s.YNc(8,m,7,2,"ng-container",9),s.qZA()(),s.TgZ(9,"div"),s.Hsn(10),s.qZA()()()}if(2&p){const d=s.oxw();s.xp6(3),s.Q6J("innerHTML",d.title,s.oJD),s.xp6(5),s.Q6J("ngForOf",d.breads)}}const z=["*"];let M=(()=>{class p{constructor(d,v,b,Z){this.router=d,this.route=v,this.translate=b,this._carparkService=Z,this.breads=[],this.loginUser=""}ngOnInit(){let d=JSON.parse(localStorage.getItem("user-roles"))[0];this.loginUser=d,console.log(this.loginUser,"\u4fe1\u606f"),this.breads=this.buildBreadCrumb(this.route.root),this.translate.get(this.breads[0].label).subscribe(b=>{this.label=b}),this.router.events.pipe((0,g.h)(b=>b instanceof c.m2)).subscribe(()=>{this.breads=this.buildBreadCrumb(this.route.root)})}buildBreadCrumb(d,v=[""],b=[]){const Z=d.snapshot.url[0]&&d.snapshot.url[0].path,E=[...v,Z],F={...this.extractBreadcrumb(d),url:E},O=Z&&F.label?[...b,F]:b;return this.title=F.title||this.title||"",this.isMotorist&&"My Vehicle(s)"===F.label&&(this.title="My Vehicle(s)"),d.firstChild?Z?this.buildBreadCrumb(d.firstChild,E,O):this.buildBreadCrumb(d.firstChild,v,b):(this.translate.get(this.title).subscribe(U=>{this.title=U}),O)}get isMotorist(){return this._carparkService.isMotorist()}extractBreadcrumb(d){return d.snapshot.data.breadcrumb instanceof Function?d.snapshot.data.breadcrumb(d):d.snapshot.data.breadcrumb}jumpHome(){let d=JSON.parse(localStorage.getItem("user-roles"))[0]??"";this.router.navigate(d.length?[h.gpL[d]]:["/"])}}return p.\u0275fac=function(d){return new(d||p)(s.Y36(c.F0),s.Y36(c.gz),s.Y36(P.sK),s.Y36(e.x))},p.\u0275cmp=s.Xpm({type:p,selectors:[["app-title-bar"]],ngContentSelectors:z,decls:1,vars:1,consts:[["class","m-subheader",4,"ngIf"],[1,"m-subheader"],[1,"d-flex","align-items-center"],[1,"mr-auto"],[1,"m-subheader__title","m-subheader__title--separator","text-main",3,"innerHTML"],[1,"m-subheader__breadcrumbs","m-nav","m-nav--inline"],[1,"m-nav__item","m-nav__item--home"],[1,"m-nav__link","m-nav__link--icon",3,"click"],[1,"m-nav__link-icon","la","la-home"],[4,"ngFor","ngForOf"],[1,"m-nav__separator"],[1,"m-nav__item"],["class","m-nav__link",4,"ngIf"],["class","m-nav__link",3,"routerLink","queryParams",4,"ngIf"],[1,"m-nav__link"],[1,"m-nav__link-text"],[1,"m-nav__link",3,"routerLink","queryParams"]],template:function(d,v){1&d&&(s.F$t(),s.YNc(0,x,11,2,"div",0)),2&d&&s.Q6J("ngIf","ROLE_TPO_PARTNER"!==v.loginUser)},dependencies:[_.sg,_.O5,c.yS,P.X$],encapsulation:2}),p})()},7223:(L,T,o)=>{o.r(T),o.d(T,{FeedbackModule:()=>Ce,createTranslateLoader:()=>Q});var c=o(36895),g=o(24006),h=o(34793),s=o(36511),P=o(3927),e=o(94650),_=o(28555),f=o(80529),y=o(91599);let m=(()=>{class i extends P.su{constructor(t,n,a){super(n,t),this.store=t,this.http=n,this.modelName="Feedback",this.baseUrl="carpark/api/motorist-feedbacks",this.handleError=a.createHandleError(`${this.modelName}Service`)}solveIssue(t){return this.get(this.getUrl(`${this.baseUrl}/${t}/update-resolve`))}replyIssue(t){return this.post(this.getUrl("carpark/api/feedback-response-messages"),t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(_.yh),e.LFG(f.eN),e.LFG(y.k))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var x=o(30329),z=o(21532),M=o(59501),p=o(89383),k=o(76916);const d=function(){return["pending"]},v=function(){return["resolved"]};let b=(()=>{class i{constructor(t,n){this.router=t,this.translate=n}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.F0),e.Y36(p.sK))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-feedback-home"]],decls:16,vars:6,consts:[[1,"body-wrapper"],[1,"m-content"],[1,"m-portlet","m-portlet--tabs"],[1,"m-portlet__head"],[1,"m-portlet__head-tools"],["role","tablist",1,"nav","nav-tabs","m-tabs-line","m-tabs-line--primary","m-tabs-line--2x"],[1,"nav-item","m-tabs__item"],[1,"nav-link","m-tabs__link",3,"routerLink","routerLinkActive"],[1,"m-portlet__body","m-portlet__body--scrollable"],[1,"m-portlet__frame"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-title-bar"),e.TgZ(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"ul",5)(7,"li",6)(8,"a",7),e._uU(9," Pending "),e.qZA()(),e.TgZ(10,"li",6)(11,"a",7),e._uU(12," Resolved "),e.qZA()()()()(),e.TgZ(13,"div",8)(14,"div",9),e._UZ(15,"router-outlet"),e.qZA()()()()()),2&t&&(e.xp6(8),e.Q6J("routerLink",e.DdM(4,d))("routerLinkActive","active"),e.xp6(3),e.Q6J("routerLink",e.DdM(5,v))("routerLinkActive","active"))},dependencies:[h.lC,h.yS,h.Od,k.G],encapsulation:2}),i})();var Z=o(38014),F=(o(79118),o(8929)),O=o(36053),U=o(21086),S=o(2994),J=o(87545),$=o(5646),B=o(74327),H=o(17489),N=(o(19612),o(52746)),D=o(76284),W=o(50007),R=o(35635),Y=o(66616),j=o(47044),K=o(21811),w=o(38231),u=o(40269),q=o(10438);function G(i,l){if(1&i&&(e._UZ(0,"nz-option",15),e.ALo(1,"titlecase")),2&i){const t=l.$implicit;e.Q6J("nzValue",t.id)("nzLabel",e.lcZ(1,2,t.value))}}function V(i,l){if(1&i&&e._uU(0),2&i){const t=l.range;e.lnq(" ",t[0],"-",t[1]," of ",l.$implicit," items\n")}}function X(i,l){if(1&i&&(e.TgZ(0,"th"),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.xp6(1),e.Oqu(t.text)}}function ee(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"img",26),e.NdJ("click",function(){const r=e.CHM(t).$implicit,C=e.oxw(3),A=e.MAs(29);return e.KtG(C.showLargerSize(A,r))})("contextmenu",function(a){e.CHM(t);const r=e.oxw(3);return e.KtG(r.onRightClick(a))}),e.qZA()()}if(2&i){const t=l.$implicit;e.xp6(1),e.Q6J("src",t,e.LSH)}}function te(i,l){if(1&i&&(e.TgZ(0,"div",24)(1,"div",25),e.YNc(2,ee,2,1,"div",12),e.qZA()()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("ngForOf",t.attachments$)}}function ne(i,l){if(1&i&&(e.TgZ(0,"div",27),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t._expandLoading?"Loading Attachments":"No Attachment"," ")}}function ae(i,l){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"tr")(2,"td",16),e.NdJ("nzExpandChange",function(a){const C=e.CHM(t).$implicit,A=e.oxw();return e.KtG(A.onExpandChange(C.id,a))}),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td")(6,"span"),e._UZ(7,"i",17),e._uU(8),e.qZA()(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.ALo(15,"date"),e.ALo(16,"date"),e.qZA(),e.TgZ(17,"td")(18,"button",18),e.NdJ("click",function(){const r=e.CHM(t).$implicit,C=e.oxw(),A=e.MAs(27);return e.KtG(C.confirmActions(r.id,A,"reply"))}),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"button",19),e.NdJ("click",function(){const r=e.CHM(t).$implicit,C=e.oxw();return e.KtG(C.confirmActions(r.id,null,"solve"))}),e._uU(22),e.ALo(23,"translate"),e.qZA()()(),e.TgZ(24,"tr",20)(25,"nz-table",21)(26,"thead")(27,"tr")(28,"th"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"th"),e._uU(32),e.ALo(33,"translate"),e.qZA()()(),e.TgZ(34,"tbody")(35,"tr")(36,"td"),e._uU(37),e.qZA(),e.TgZ(38,"td"),e.YNc(39,te,3,1,"div",22),e.ALo(40,"async"),e.YNc(41,ne,2,1,"div",23),e.ALo(42,"async"),e.qZA()()()()(),e.BQk()}if(2&i){const t=l.$implicit,n=l.index,a=e.oxw();e.xp6(1),e.ekj("ant-table-row-odd",n%2==1),e.xp6(1),e.Q6J("nzExpand",a.expandSet.has(t.id)),e.xp6(2),e.Oqu(t.id),e.xp6(4),e.hij(" ",t.carPlateNo," "),e.xp6(2),e.Oqu(((t.firstName||"")+" "+(t.secondName||"")).trim()),e.xp6(2),e.Oqu(t.issueType),e.xp6(2),e.AsE(" ",e.xi3(15,20,t.createTime,"d LLL yyyy")," ",e.xi3(16,23,t.createTime,"h:mm:ss a")," "),e.xp6(4),e.Q6J("disabled",a.viewOnly||a.solving[t.id]),e.xp6(1),e.hij(" ",e.lcZ(20,26,"Reply")," "),e.xp6(2),e.Q6J("disabled",a.viewOnly||a.solving[t.id]),e.xp6(1),e.hij(" ",e.lcZ(23,28,"Solve")," "),e.xp6(2),e.Q6J("nzExpand",a.expandSet.has(t.id)),e.xp6(1),e.Q6J("nzShowPagination",!1),e.xp6(4),e.Oqu(e.lcZ(30,30,"Feedback")),e.xp6(3),e.Oqu(e.lcZ(33,32,"Attachment")),e.xp6(5),e.Oqu(t.feedBack||"-"),e.xp6(2),e.Q6J("ngIf",e.lcZ(40,34,t.attachments$)),e.xp6(2),e.Q6J("ngIf",!e.lcZ(42,36,t.attachments$))}}function ie(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",28)(1,"label",29),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"textarea",30),e.NdJ("ngModelChange",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.replyContent=a)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,2,"Content"),": "),e.xp6(2),e.Q6J("ngModel",t.replyContent)}}function oe(i,l){if(1&i&&(e.TgZ(0,"div",31)(1,"div"),e._UZ(2,"app-image-zoom",32),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("picUrl",t.selectedImg)}}let se=(()=>{class i extends N.t{constructor(t,n,a,r,C,A,I,Te){super(),this.router=t,this.route=n,this.feedbackService=a,this.codeTablesService=r,this.translate=C,this.assetsService=A,this.store=I,this.nzModalService=Te,this.tableHeaders=[{text:"ID",width:"80px"},{text:"Vehicle",column:"vehicle",width:"150px"},{text:"User Name",column:"startDate",width:"160px"},{text:"Type",column:"endDate",width:"150px"},{text:"Date Created",column:"userName",width:"300px"},{text:"Actions",width:"200px"}],this.issueType="",this.keyword$=new F.xQ,this.attachmentsLoading={},this.alive=!0,this.defaultImgWidth=800,this.defaultImgHeight=500,this.imgWidth=this.defaultImgWidth,this.imgHeight=this.defaultImgHeight,this.expandSet=new Set,this.solving={},this.user$=I.pipe((0,_.Ys)("global"))}get data(){return this._data}set data(t){this._data=t.map(n=>(this.attachmentsLoading[n.id]=!0,{...n,attachments$:this.getAttachments(n.id).pipe((0,S.b)(()=>this.attachmentsLoading[n.id]=!1))}))}getAttachments(t){return this.feedbackService.getModel(t).pipe((0,J.w)(({assets:n})=>n.length?(0,O.aj)(n.map(a=>this.assetsService.getImageByUuid(a.assetUuid))):(0,U.of)(null)),(0,$._)(1),(0,B.x)())}get filterParams(){return{status:this.issueType,key:this.keyword,sort:"createTime,desc"}}reloadData(){this.reloadDataService(this.feedbackService)}pageChanged(t){this.pagination=t,this.reloadData()}replyIssue(t){this.replyContent&&this.feedbackService.replyIssue({feedBackId:t,message:this.replyContent}).subscribe(()=>{this.solving[t]=!0,this.reloadData(),this.router.navigate(["/motorist-feedbacks/resolved"])},null,()=>this.solving[t]=!1)}solveIssue(t){this.solving[t]=!0,this.feedbackService.solveIssue(t).subscribe(()=>this.reloadData(),null,()=>this.solving[t]=!1)}ngOnInit(){this.keyword$.debounceTime(500).subscribe(()=>{this.reloadData()}),this.issueTypes$=this.codeTablesService.filterModelByType(Z.BcL.FeedbackIssue);const t=this.tableHeaders.map(n=>n.text);this.translate.get(t).subscribe(n=>{this.tableHeaders.forEach(a=>{for(let r in n)n.hasOwnProperty(r)&&a.text===r&&(a.text=n[r])})}),this.user$.takeWhile(()=>this.alive).subscribe(({user:n})=>{this.viewOnly=(0,H.intersection)([Z.i44.ThirdParty,Z.i44.Tester,Z.i44.Auditor],n.authorities).length>0})}saveAs(t,n){t.attachments$.subscribe(a=>{this.saveFile(`${t.id}_${n}`,a[n].changingThisBreaksApplicationSecurity)})}saveFile(t,n){const a=document.createElement("a");document.body.appendChild(a),a.href=n,a.download=t,a.click(),setTimeout(()=>{window.URL.revokeObjectURL(n),document.body.removeChild(a)},0)}confirmActions(t,n,a){"reply"===a?this.nzModalService.create({nzTitle:"Reply",nzContent:n,nzOnOk:()=>this.replyIssue(t)}):this.nzModalService.confirm({nzTitle:"Confirm solve this issue?",nzOnOk:()=>this.solveIssue(t)})}showLargerSize(t,n){this.selectedImg=n,this.imgWidth=this.defaultImgWidth,this.imgHeight=this.defaultImgHeight,this.nzModalService.create({nzTitle:"Large Size Image",nzContent:t,nzWidth:800,nzFooter:null})}onRightClick(t){return!1}imgZoom(t){if("minus"===t){if(this.imgWidth==this.defaultImgWidth||this.imgHeight==this.defaultImgHeight)return;return this.imgWidth-=100,void(this.imgHeight-=100)}this.imgWidth+=100,this.imgHeight+=100}onExpandChange(t,n){if(n){this.expandSet.add(t);const a=this.listData.find(r=>r.id===t);a&&!a._expandLoaded&&(a._expandLoading=!0,a.attachments$=this.getAttachments(t).pipe((0,S.b)(()=>{a._expandLoading=!1,a._expandLoaded=!0},r=>{a._expandLoading=!1,a._expandLoaded=!0})))}else this.expandSet.delete(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.F0),e.Y36(h.gz),e.Y36(m),e.Y36(s.I),e.Y36(p.sK),e.Y36(D.z),e.Y36(_.yh),e.Y36(W.Sf))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-feedback-pending"]],features:[e.qOj],decls:30,vars:21,consts:[[1,"form-group","m-form__group","m-portlet__filters"],[1,"filter-wrap"],[1,"filter-item"],[1,"filter-label"],["nzPlaceHolder","Please Select",2,"width","160px",3,"ngModel","ngModelChange"],["nzValue","",3,"nzLabel"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nz-input","","type","text","placeholder","Vehicle no. / Username",2,"width","200px",3,"ngModel","ngModelChange"],["rangeTemplate",""],[3,"nzData","nzFrontPagination","nzLoading","nzTotal","nzPageSize","nzPageIndex","nzShowSizeChanger","nzShowTotal","nzQueryParams"],["basicTable",""],["nzWidth","60px"],[4,"ngFor","ngForOf"],["replyModal",""],["largeSizeImg",""],[3,"nzValue","nzLabel"],[3,"nzExpand","nzExpandChange"],[1,"la","la-automobile"],["nz-button","","nzType","primary",3,"disabled","click"],["nz-button","","nzType","primary",1,"mgl16",3,"disabled","click"],[3,"nzExpand"],["nzSize","small","nzTemplateMode","",3,"nzShowPagination"],["class","col",4,"ngIf"],["style","width: 200px;",4,"ngIf"],[1,"col"],[1,"row","m-0"],[1,"mr-3",2,"max-width","90px","max-height","200px",3,"src","click","contextmenu"],[2,"width","200px"],[1,"form-group"],["for","message-text",1,"form-control-label"],["name","replyContent","nz-input","",3,"ngModel","ngModelChange"],[1,"modal-body","m-form","m-form--fit","m-form--label-align-right","text-center"],[3,"picUrl"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"nz-select",4),e.NdJ("ngModelChange",function(r){return n.issueType=r})("ngModelChange",function(){return n.reloadData()}),e._UZ(7,"nz-option",5),e.ALo(8,"translate"),e.YNc(9,G,2,4,"nz-option",6),e.ALo(10,"async"),e.qZA()()(),e.TgZ(11,"div",1)(12,"div",2)(13,"span",3),e._uU(14,"Vehicle no. / Username:"),e.qZA(),e.TgZ(15,"input",7),e.NdJ("ngModelChange",function(r){return n.keyword=r})("ngModelChange",function(r){return n.keyword$.next(r)}),e.qZA()()()(),e.YNc(16,V,1,3,"ng-template",null,8,e.W1O),e.TgZ(18,"nz-table",9,10),e.NdJ("nzQueryParams",function(r){return n.onQueryParamsChange(r)}),e.TgZ(20,"thead")(21,"tr"),e._UZ(22,"th",11),e.YNc(23,X,2,1,"th",12),e.qZA()(),e.TgZ(24,"tbody"),e.YNc(25,ae,43,38,"ng-container",12),e.qZA()(),e.YNc(26,ie,5,4,"ng-template",null,13,e.W1O),e.YNc(28,oe,3,1,"ng-template",null,14,e.W1O)),2&t){const a=e.MAs(17),r=e.MAs(19);e.xp6(4),e.hij("",e.lcZ(5,15,"Type"),":"),e.xp6(2),e.Q6J("ngModel",n.issueType),e.xp6(1),e.Q6J("nzLabel",e.lcZ(8,17,"All")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(10,19,n.issueTypes$)),e.xp6(6),e.Q6J("ngModel",n.keyword),e.xp6(3),e.Q6J("nzData",n.listData)("nzFrontPagination",!1)("nzLoading",n.loading)("nzTotal",n.pagination.totalCount)("nzPageSize",n.pagination.rowsPerPage)("nzPageIndex",n.pagination.page)("nzShowSizeChanger",!0)("nzShowTotal",a),e.xp6(5),e.Q6J("ngForOf",n.tableHeaders),e.xp6(2),e.Q6J("ngForOf",r.data)}},dependencies:[c.sg,c.O5,g.Fj,g.JJ,g.On,R.Zp,Y.ix,j.w,K.dQ,w.Ip,w.Vq,u.N8,u.Uo,u._C,u.h7,u.Om,u.p0,u.$Z,u.d3,u.Vk,q.Y,c.Ov,c.rS,c.uU,p.X$],styles:[".modalContent[_ngcontent-%COMP%]{display:flex}.modalContent[_ngcontent-%COMP%]   .imgZoomBtnContianer[_ngcontent-%COMP%]{flex-direction:column;justify-content:flex-end;align-items:center;display:flex;margin-left:20px}.modalContent[_ngcontent-%COMP%]   .imgZoomBtnContianer[_ngcontent-%COMP%]   .minusBtn[_ngcontent-%COMP%]{margin-bottom:10px}.modalContent[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]{width:900px;height:500px;overflow:auto}.two-line[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}"]}),i})();var re=o(20388);function le(i,l){if(1&i&&(e._UZ(0,"nz-option",15),e.ALo(1,"titlecase")),2&i){const t=l.$implicit;e.Q6J("nzValue",t.id)("nzLabel",e.lcZ(1,2,t.value))}}function de(i,l){if(1&i&&e._uU(0),2&i){const t=l.range;e.lnq(" ",t[0],"-",t[1]," of ",l.$implicit," items\n")}}function ce(i,l){if(1&i&&(e.TgZ(0,"th",16),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("nzWidth",l.last?"500px":""),e.xp6(1),e.Oqu(t.text)}}function me(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"img",26),e.NdJ("click",function(){const r=e.CHM(t).$implicit,C=e.oxw(3),A=e.MAs(27);return e.KtG(C.showLargerSize(A,r))})("contextmenu",function(a){e.CHM(t);const r=e.oxw(3);return e.KtG(r.onRightClick(a))}),e.qZA()()}if(2&i){const t=l.$implicit;e.xp6(1),e.Q6J("src",t,e.LSH)}}function pe(i,l){if(1&i&&(e.TgZ(0,"div",24)(1,"div",25),e.YNc(2,me,2,1,"div",13),e.qZA()()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("ngForOf",t.attachments$)}}function ge(i,l){if(1&i&&(e.TgZ(0,"div",27),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t._expandLoading?"Loading Attachments":"No Attachment"," ")}}function he(i,l){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"tr")(2,"td",17),e.NdJ("nzExpandChange",function(a){const C=e.CHM(t).$implicit,A=e.oxw();return e.KtG(A.onExpandChange(C.id,a))}),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td")(6,"span"),e._UZ(7,"i",18),e._uU(8),e.qZA()(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.ALo(15,"date"),e.ALo(16,"date"),e.qZA(),e.TgZ(17,"td"),e._uU(18),e.ALo(19,"date"),e.ALo(20,"date"),e.qZA(),e.TgZ(21,"td"),e._uU(22),e.qZA()(),e.TgZ(23,"tr",19)(24,"nz-table",20)(25,"thead")(26,"tr")(27,"th",21),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"th"),e._uU(31),e.ALo(32,"translate"),e.qZA()()(),e.TgZ(33,"tbody")(34,"tr")(35,"td"),e._uU(36),e.qZA(),e.TgZ(37,"td"),e.YNc(38,pe,3,1,"div",22),e.ALo(39,"async"),e.YNc(40,ge,2,1,"div",23),e.ALo(41,"async"),e.qZA()()()()(),e.BQk()}if(2&i){const t=l.$implicit,n=l.index,a=e.oxw();e.xp6(1),e.ekj("ant-table-row-odd",n%2==1),e.xp6(1),e.Q6J("nzExpand",a.expandSet.has(t.id)),e.xp6(2),e.Oqu(t.id),e.xp6(4),e.hij(" ",t.carPlateNo," "),e.xp6(2),e.Oqu(((t.firstName||"")+" "+(t.secondName||"")).trim()),e.xp6(2),e.Oqu(t.issueType),e.xp6(2),e.AsE(" ",e.xi3(15,19,t.createTime,"d LLL yyyy")," ",e.xi3(16,22,t.createTime,"h:mm:ss a")," "),e.xp6(4),e.AsE(" ",e.xi3(19,25,t.solvedTime,"d LLL yyyy")," ",e.xi3(20,28,t.solvedTime,"h:mm:ss a")," "),e.xp6(4),e.Oqu(t.reply),e.xp6(1),e.Q6J("nzExpand",a.expandSet.has(t.id)),e.xp6(1),e.Q6J("nzShowPagination",!1),e.xp6(4),e.Oqu(e.lcZ(29,31,"Feedback")),e.xp6(3),e.Oqu(e.lcZ(32,33,"Attachment")),e.xp6(5),e.hij(" ",t.feedBack||"-"," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(39,35,t.attachments$)),e.xp6(2),e.Q6J("ngIf",!e.lcZ(41,37,t.attachments$))}}const _e=function(i,l){return{width:i,height:l}};function ue(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",28)(1,"div",29)(2,"div",30)(3,"img",31),e.NdJ("contextmenu",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.onRightClick(a))}),e.qZA()(),e.TgZ(4,"div",32)(5,"button",33),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.imgZoom("minus"))}),e._uU(6,"-"),e.qZA(),e.TgZ(7,"button",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.imgZoom("plus"))}),e._uU(8,"+"),e.qZA()()(),e.TgZ(9,"div",35)(10,"button",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.cancel())}),e._uU(11,"Cancel"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("src",t.selectedImg,e.LSH)("ngStyle",e.WLB(2,_e,t.imgWidth+"px",t.imgHeight+"px"))}}let fe=(()=>{class i extends N.t{constructor(t,n,a,r,C,A,I){super(),this.router=t,this.route=n,this.feedbackService=a,this.translate=r,this.assetsService=C,this.modalService=A,this.codeTablesService=I,this.tableHeaders=[{text:"ID",width:"80px"},{text:"Vehicle",column:"vehicle",width:"120px"},{text:"User Name",column:"startDate",width:"160px"},{text:"Type",column:"endDate",width:"80px"},{text:"Time Created",column:"userName",width:"200px"},{text:"Time Solved",column:"userName",width:"200px"},{text:"Reply",column:"",width:"100px"}],this.issueType="",this.keyword$=new F.xQ,this.attachmentsLoading={},this.defaultImgWidth=800,this.defaultImgHeight=500,this.imgWidth=this.defaultImgWidth,this.imgHeight=this.defaultImgHeight,this.expandSet=new Set}get data(){return this._data}set data(t){this._data=t.map(n=>(this.attachmentsLoading[n.id]=!0,{...n,attachments$:this.getAttachments(n.id).pipe((0,S.b)(()=>this.attachmentsLoading[n.id]=!1))}))}getAttachments(t){return this.feedbackService.getModel(t).pipe((0,J.w)(({assets:n})=>n.length?(0,O.aj)(n.map(a=>this.assetsService.getImageByUuid(a.assetUuid))):(0,U.of)(null)),(0,$._)(1),(0,B.x)())}get filterParams(){return{key:this.keyword,status:1}}reloadData(){this.reloadDataService(this.feedbackService)}pageChanged(t){this.pagination=t,this.reloadData()}ngOnInit(){this.issueTypes$=this.codeTablesService.filterModelByType(Z.BcL.FeedbackIssue),this.keyword$.debounceTime(500).subscribe(()=>{this.reloadData()});const t=this.tableHeaders.map(n=>n.text);this.translate.get(t).subscribe(n=>{this.tableHeaders.forEach(a=>{for(let r in n)n.hasOwnProperty(r)&&a.text===r&&(a.text=n[r])})}),setTimeout(()=>{console.log(this.issueType)},3e3)}saveAs(t,n){t.attachments$.subscribe(a=>{this.saveFile(`${t.id}_${n}`,a[n].changingThisBreaksApplicationSecurity)})}saveFile(t,n){const a=document.createElement("a");document.body.appendChild(a),a.href=n,a.download=t,a.click(),setTimeout(()=>{window.URL.revokeObjectURL(n),document.body.removeChild(a)},0)}showLargerSize(t,n){this.selectedImg=n,this.modalRef=this.modalService.show(t,{ignoreBackdropClick:!0,class:"gray modal-lg"}),this.imgWidth=this.defaultImgWidth,this.imgHeight=this.defaultImgHeight}onRightClick(t){return!1}cancel(){this.modalRef.hide()}imgZoom(t){if("minus"===t){if(this.imgWidth==this.defaultImgWidth||this.imgHeight==this.defaultImgHeight)return;return this.imgWidth-=100,void(this.imgHeight-=100)}this.imgWidth+=100,this.imgHeight+=100}onExpandChange(t,n){if(n){this.expandSet.add(t);const a=this.listData.find(r=>r.id===t);a&&!a._expandLoaded&&(a._expandLoading=!0,a.attachments$=this.getAttachments(t).pipe((0,S.b)(()=>{a._expandLoading=!1,a._expandLoaded=!0},r=>{a._expandLoading=!1,a._expandLoaded=!0})))}else this.expandSet.delete(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.F0),e.Y36(h.gz),e.Y36(m),e.Y36(p.sK),e.Y36(D.z),e.Y36(re.tT),e.Y36(s.I))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-feedback-resolved"]],features:[e.qOj],decls:28,vars:21,consts:[[1,"form-group","m-form__group","m-portlet__filters"],[1,"filter-wrap"],[1,"filter-item"],[1,"filter-label"],["nzPlaceHolder","Please Select",2,"width","160px",3,"ngModel","ngModelChange"],["nzValue","",3,"nzLabel"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nz-input","","type","text","placeholder","Vehicle no. / Username",2,"width","200px",3,"ngModel","ngModelChange"],["rangeTemplate",""],[3,"nzData","nzFrontPagination","nzLoading","nzTotal","nzPageSize","nzPageIndex","nzShowSizeChanger","nzShowTotal","nzQueryParams"],["basicTable",""],["nzWidth","60px"],[3,"nzWidth",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["largeSizeImg",""],[3,"nzValue","nzLabel"],[3,"nzWidth"],[3,"nzExpand","nzExpandChange"],[1,"la","la-automobile"],[3,"nzExpand"],["nzSize","small","nzTemplateMode","",3,"nzShowPagination"],["nzWidth","600px"],["class","col",4,"ngIf"],["style","width: 200px;",4,"ngIf"],[1,"col"],[1,"row","m-0"],[1,"mr-3",2,"max-width","90px","max-height","200px",3,"src","click","contextmenu"],[2,"width","200px"],[1,"modal-body","m-form","m-form--fit","m-form--label-align-right","text-center"],[1,"modalContent"],[1,"imgContainer"],["alt","",1,"modal-large-size-img",3,"src","ngStyle","contextmenu"],[1,"imgZoomBtnContianer"],["type","button",1,"btn","btn-default","mr-3","minusBtn",3,"click"],["type","button",1,"btn","btn-default","mr-3",3,"click"],[1,"mt-3","text-center"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"nz-select",4),e.NdJ("ngModelChange",function(r){return n.issueType=r})("ngModelChange",function(){return n.reloadData()}),e._UZ(7,"nz-option",5),e.ALo(8,"translate"),e.YNc(9,le,2,4,"nz-option",6),e.ALo(10,"async"),e.qZA()()(),e.TgZ(11,"div",1)(12,"div",2)(13,"span",3),e._uU(14,"Vehicle no. / Username:"),e.qZA(),e.TgZ(15,"input",7),e.NdJ("ngModelChange",function(r){return n.keyword=r})("ngModelChange",function(r){return n.keyword$.next(r)}),e.qZA()()()(),e.YNc(16,de,1,3,"ng-template",null,8,e.W1O),e.TgZ(18,"nz-table",9,10),e.NdJ("nzQueryParams",function(r){return n.onQueryParamsChange(r)}),e.TgZ(20,"thead")(21,"tr"),e._UZ(22,"th",11),e.YNc(23,ce,2,2,"th",12),e.qZA()(),e.TgZ(24,"tbody"),e.YNc(25,he,42,39,"ng-container",13),e.qZA()(),e.YNc(26,ue,12,5,"ng-template",null,14,e.W1O)),2&t){const a=e.MAs(17),r=e.MAs(19);e.xp6(4),e.hij("",e.lcZ(5,15,"Type"),":"),e.xp6(2),e.Q6J("ngModel",n.issueType),e.xp6(1),e.Q6J("nzLabel",e.lcZ(8,17,"All")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(10,19,n.issueTypes$)),e.xp6(6),e.Q6J("ngModel",n.keyword),e.xp6(3),e.Q6J("nzData",n.listData)("nzFrontPagination",!1)("nzLoading",n.loading)("nzTotal",n.pagination.totalCount)("nzPageSize",n.pagination.rowsPerPage)("nzPageIndex",n.pagination.page)("nzShowSizeChanger",!0)("nzShowTotal",a),e.xp6(5),e.Q6J("ngForOf",n.tableHeaders),e.xp6(2),e.Q6J("ngForOf",r.data)}},dependencies:[c.sg,c.O5,c.PC,g.Fj,g.JJ,g.On,R.Zp,w.Ip,w.Vq,u.N8,u.Uo,u._C,u.h7,u.Om,u.p0,u.$Z,u.d3,u.Vk,c.Ov,c.rS,c.uU,p.X$],styles:[".modalContent[_ngcontent-%COMP%]{display:flex}.modalContent[_ngcontent-%COMP%]   .imgZoomBtnContianer[_ngcontent-%COMP%]{flex-direction:column;justify-content:flex-end;align-items:center;display:flex;margin-left:20px}.modalContent[_ngcontent-%COMP%]   .imgZoomBtnContianer[_ngcontent-%COMP%]   .minusBtn[_ngcontent-%COMP%]{margin-bottom:10px}.modalContent[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]{width:900px;height:500px;overflow:auto}.two-line[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}"]}),i})();var xe=o(19832),ve=o(60097);function Q(i){return new xe.w(i,"../assets/i18n/",".json")}const be=[{path:"",component:M.f,children:[{path:"",component:b,children:[{path:"",redirectTo:"pending",pathMatch:"full"},{path:"pending",component:se,data:{breadcrumb:{label:"Pending"}}},{path:"resolved",component:fe,data:{breadcrumb:{label:"Resolved"}}}]}]}];let Ce=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[m,s.I,D.z,ve.x],imports:[c.ez,g.u5,h.Bz.forChild(be),z.x,x.D,p.aw.forChild({loader:{provide:p.Zw,useFactory:Q,deps:[f.eN]}}),h.Bz]}),i})()},7499:(L,T,o)=>{Object.defineProperty(T,"__esModule",{value:!0});var c=o(77415),g=o(67694);c.Observable.prototype.takeWhile=g.takeWhile},67694:(L,T,o)=>{Object.defineProperty(T,"__esModule",{value:!0});var c=o(41451);T.takeWhile=function g(h){return c.takeWhile(h)(this)}},19612:(L,T,o)=>{o(7499)}}]);