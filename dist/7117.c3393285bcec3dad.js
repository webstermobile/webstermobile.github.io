"use strict";(self.webpackChunkst_admin=self.webpackChunkst_admin||[]).push([[7117],{76916:(w,C,a)=>{a.d(C,{G:()=>A});var h=a(34793),x=a(92198),M=a(38014),n=a(94650),O=a(89383),P=a(60097),v=a(36895);function T(r,p){if(1&r&&(n.TgZ(0,"a",14)(1,"span",15),n._uU(2),n.ALo(3,"translate"),n.qZA()()),2&r){const i=n.oxw().$implicit;n.xp6(2),n.hij(" ",n.lcZ(3,1,i.label)," ")}}function S(r,p){if(1&r&&(n.TgZ(0,"a",16)(1,"span",15),n._uU(2),n.ALo(3,"translate"),n.qZA()()),2&r){const i=n.oxw(),g=i.$implicit,m=i.last,_=n.oxw(2);n.Q6J("routerLink",g.url)("queryParams",m&&_.route.snapshot.queryParams),n.xp6(2),n.hij(" ",n.lcZ(3,3,g.label)," ")}}function B(r,p){if(1&r&&(n.ynx(0),n.TgZ(1,"li",10)(2,"span"),n._uU(3," > "),n.qZA()(),n.TgZ(4,"li",11),n.YNc(5,T,4,3,"a",12),n.YNc(6,S,4,5,"a",13),n.qZA(),n.BQk()),2&r){const i=p.first;n.xp6(5),n.Q6J("ngIf",i),n.xp6(1),n.Q6J("ngIf",!i)}}function t(r,p){if(1&r){const i=n.EpF();n.TgZ(0,"div",1)(1,"div",2)(2,"div",3),n._UZ(3,"h3",4),n.TgZ(4,"ul",5)(5,"li",6)(6,"a",7),n.NdJ("click",function(){n.CHM(i);const m=n.oxw();return n.KtG(m.jumpHome())}),n._UZ(7,"i",8),n.qZA()(),n.YNc(8,B,7,2,"ng-container",9),n.qZA()(),n.TgZ(9,"div"),n.Hsn(10),n.qZA()()()}if(2&r){const i=n.oxw();n.xp6(3),n.Q6J("innerHTML",i.title,n.oJD),n.xp6(5),n.Q6J("ngForOf",i.breads)}}const Z=["*"];let A=(()=>{class r{constructor(i,g,m,_){this.router=i,this.route=g,this.translate=m,this._carparkService=_,this.breads=[],this.loginUser=""}ngOnInit(){let i=JSON.parse(localStorage.getItem("user-roles"))[0];this.loginUser=i,console.log(this.loginUser,"\u4fe1\u606f"),this.breads=this.buildBreadCrumb(this.route.root),this.translate.get(this.breads[0].label).subscribe(m=>{this.label=m}),this.router.events.pipe((0,x.h)(m=>m instanceof h.m2)).subscribe(()=>{this.breads=this.buildBreadCrumb(this.route.root)})}buildBreadCrumb(i,g=[""],m=[]){const _=i.snapshot.url[0]&&i.snapshot.url[0].path,b=[...g,_],d={...this.extractBreadcrumb(i),url:b},f=_&&d.label?[...m,d]:m;return this.title=d.title||this.title||"",this.isMotorist&&"My Vehicle(s)"===d.label&&(this.title="My Vehicle(s)"),i.firstChild?_?this.buildBreadCrumb(i.firstChild,b,f):this.buildBreadCrumb(i.firstChild,g,m):(this.translate.get(this.title).subscribe(y=>{this.title=y}),f)}get isMotorist(){return this._carparkService.isMotorist()}extractBreadcrumb(i){return i.snapshot.data.breadcrumb instanceof Function?i.snapshot.data.breadcrumb(i):i.snapshot.data.breadcrumb}jumpHome(){let i=JSON.parse(localStorage.getItem("user-roles"))[0]??"";this.router.navigate(i.length?[M.gpL[i]]:["/"])}}return r.\u0275fac=function(i){return new(i||r)(n.Y36(h.F0),n.Y36(h.gz),n.Y36(O.sK),n.Y36(P.x))},r.\u0275cmp=n.Xpm({type:r,selectors:[["app-title-bar"]],ngContentSelectors:Z,decls:1,vars:1,consts:[["class","m-subheader",4,"ngIf"],[1,"m-subheader"],[1,"d-flex","align-items-center"],[1,"mr-auto"],[1,"m-subheader__title","m-subheader__title--separator","text-main",3,"innerHTML"],[1,"m-subheader__breadcrumbs","m-nav","m-nav--inline"],[1,"m-nav__item","m-nav__item--home"],[1,"m-nav__link","m-nav__link--icon",3,"click"],[1,"m-nav__link-icon","la","la-home"],[4,"ngFor","ngForOf"],[1,"m-nav__separator"],[1,"m-nav__item"],["class","m-nav__link",4,"ngIf"],["class","m-nav__link",3,"routerLink","queryParams",4,"ngIf"],[1,"m-nav__link"],[1,"m-nav__link-text"],[1,"m-nav__link",3,"routerLink","queryParams"]],template:function(i,g){1&i&&(n.F$t(),n.YNc(0,t,11,2,"div",0)),2&i&&n.Q6J("ngIf","ROLE_TPO_PARTNER"!==g.loginUser)},dependencies:[v.sg,v.O5,h.yS,O.X$],encapsulation:2}),r})()},27117:(w,C,a)=>{a.r(C),a.d(C,{BusChargingSessionModule:()=>D});var h=a(36895),x=a(24006),M=a(34793),n=a(70853),O=a(30329),P=a(21532),v=a(59501),T=a(59857),S=a(15439),B=a(61715),t=a(94650),Z=a(76916);const A=["scollRight"];function r(s,l){if(1&s&&(t.ynx(0),t.TgZ(1,"div"),t._uU(2),t.qZA(),t.BQk()),2&s){const e=l.$implicit;t.xp6(2),t.Oqu(e)}}function p(s,l){if(1&s&&(t.TgZ(0,"div",17)(1,"div"),t._uU(2),t.qZA(),t.TgZ(3,"div",18),t._uU(4),t.qZA(),t.TgZ(5,"div"),t._uU(6),t.qZA()()),2&s){const e=l.$implicit,o=t.oxw();t.xp6(2),t.Oqu(e.name),t.xp6(1),t.Q6J("ngStyle",o.showStatus(e)),t.xp6(1),t.Oqu(e.busStatus),t.xp6(2),t.Oqu(e.mode)}}const i=function(s){return{left:s}};function g(s,l){if(1&s&&(t.TgZ(0,"div",19),t._uU(1),t._UZ(2,"div",20),t.qZA()),2&s){const e=l.$implicit,o=t.oxw();t.xp6(1),t.hij("",e.text," "),t.xp6(1),t.Q6J("ngStyle",t.VKq(2,i,o.getHourAndTime(e.text)+"px"))}}function m(s,l){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.value)}}function _(s,l){}function b(s,l){if(1&s&&(t.TgZ(0,"div",18),t.YNc(1,m,2,1,"span",23),t.YNc(2,_,0,0,"ng-template",null,24,t.W1O),t.qZA()),2&s){const e=l.$implicit,o=t.MAs(3),c=t.oxw(2);t.Q6J("ngStyle",c.showBusStatus(e)),t.xp6(1),t.Q6J("ngIf","Heating"!==e.value)("ngIfElse",o)}}function d(s,l){if(1&s&&(t.TgZ(0,"div",21),t.YNc(1,b,4,3,"div",22),t.qZA()),2&s){const e=l.$implicit;t.xp6(1),t.Q6J("ngForOf",e.timeArr)}}const E=[{path:"",component:v.f,children:[{path:"",component:(()=>{class s{constructor(e){this.busService=e,this.tableHeader=[],this.tableData=[],this.timeList=[],this.subscription$=[],this.colorList=T.Q}ngOnInit(){this.init()}init(){this.now=new Date;for(let e=0;e<24;e++)this.timeList.push({text:`${e<10?"0"+e:e}:00`,current:!1});this.subscription$.push((0,B.F)(1e3).subscribe(e=>{this.now=new Date,0===e&&(this.scollRight.nativeElement.scrollLeft=this.getHourAndTime(null,!0))},()=>{this.subscription$.forEach(e=>{e.unsubscribe()})},()=>{this.subscription$.forEach(e=>{e.unsubscribe()})})),this.busService.isBusAdmin()?(this.tableHeader=["Bus","Status","Mode"],this.subscription$.push(this.busService.getVehicleSessionData().subscribe(e=>{this.tableData=e.list,this.getCurrentStatus()}))):(this.tableHeader=["Charger","Status","Mode"],this.subscription$.push(this.busService.getEVownerVehicleSessionData().subscribe(e=>{this.tableData=e.list,this.getCurrentStatus()})))}getCurrentStatus(){const e=S().format("HH:mm");for(let o=0;o<this.tableData.length;o++){const c=this.tableData[o].timeArr;this.tableData[o].busStatus="Idle";for(let u=0;u<c.length;u++)if(c[u].start<=e&&e<=c[u].end){this.tableData[o].busStatus=c[u].status;break}}}showStatus(e){let o={background:"#fff",color:"#fff"};if(e.busStatus){const c=e.busStatus.toLowerCase();o={background:this.colorList[c],color:"idle"===e.busStatus.toLowerCase()?"#fff":"#000"}}return o}showBusStatus(e){if(e.status){const o=e.status.toLowerCase(),c=e.value.toLowerCase();let u=+(""+(this.getHourAndTime(e.end)-this.getHourAndTime(e.start)));if(u<0&&(u=+(""+(this.getHourAndTime("24:00")-this.getHourAndTime(e.start)))),"heating"!==c)return{background:"heating"===c?this.colorList[c]:this.colorList[o],left:`${this.getHourAndTime(e.start)}px`,width:`${u}px`}}return{background:"#fff"}}getHourAndTime(e,o){let c=0,u=0;return o||([c,u]=e.split(":").map(L=>+L)),o&&this.now&&(c=this.now.getHours(),u=this.now.getMinutes()),Number(60*c+ +u/60*60)+30}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(n.Z))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-bus-charging-session"]],viewQuery:function(e,o){if(1&e&&t.Gf(A,5),2&e){let c;t.iGM(c=t.CRH())&&(o.scollRight=c.first)}},decls:19,vars:7,consts:[[1,"body-wrapper"],[1,"m-content"],[1,"m-portlet","m-portlet--bordered-semi","m--padding-top-40"],[1,"m-portlet__body"],[1,"session-container"],[1,"main"],[1,"left-fixed"],[1,"name",2,"margin-bottom","20px"],[4,"ngFor","ngForOf"],["class","label",4,"ngFor","ngForOf"],[1,"right-time-main"],["scollRight",""],[1,"time-container",2,"margin-bottom","20px"],["class","time-item",4,"ngFor","ngForOf"],["class","status-container",4,"ngFor","ngForOf"],[1,"now-line",3,"ngStyle"],[1,"now"],[1,"label"],[1,"status",3,"ngStyle"],[1,"time-item"],[1,"time-line",3,"ngStyle"],[1,"status-container"],["class","status",3,"ngStyle",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["heating",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-title-bar"),t.TgZ(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),t.YNc(9,r,3,1,"ng-container",8),t.qZA(),t.YNc(10,p,7,4,"div",9),t.qZA(),t.TgZ(11,"div",10,11)(13,"div",12),t.YNc(14,g,3,4,"div",13),t.qZA(),t.YNc(15,d,2,1,"div",14),t.TgZ(16,"div",15)(17,"div",16),t._uU(18,"Now"),t.qZA()()()()()()()()()),2&e&&(t.xp6(9),t.Q6J("ngForOf",o.tableHeader),t.xp6(1),t.Q6J("ngForOf",o.tableData),t.xp6(4),t.Q6J("ngForOf",o.timeList),t.xp6(1),t.Q6J("ngForOf",o.tableData),t.xp6(1),t.Q6J("ngStyle",t.VKq(5,i,o.getHourAndTime("",!0)+"px")))},dependencies:[h.sg,h.O5,h.PC,Z.G],styles:[".session-container[_ngcontent-%COMP%]{position:relative;width:100%}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]{display:flex;flex-flow:row;width:100%;align-items:center}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .left-fixed[_ngcontent-%COMP%]{width:240px;display:flex;flex-wrap:wrap;margin-right:10px}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .left-fixed[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%], .session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .left-fixed[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{width:100%;display:flex}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .left-fixed[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .left-fixed[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:33.3%;flex:auto;text-align:center;padding:5px}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .left-fixed[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%], .session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .left-fixed[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{font-weight:bolder;margin-bottom:20px;border-radius:10px}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .right-time-main[_ngcontent-%COMP%]{flex:1;height:100%;overflow-x:auto;overflow-y:hidden;display:flex;position:relative;flex-direction:column;border-left:1px solid rgba(161,161,161,.75)}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .right-time-main[_ngcontent-%COMP%]   .time-container[_ngcontent-%COMP%]{display:flex;height:32px;margin-bottom:4px}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .right-time-main[_ngcontent-%COMP%]   .time-container[_ngcontent-%COMP%]   .time-item[_ngcontent-%COMP%]{width:60px;text-align:center;flex-shrink:0;padding:5px 0;border-right:0}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .right-time-main[_ngcontent-%COMP%]   .time-container[_ngcontent-%COMP%]   .time-item[_ngcontent-%COMP%]   .time-line[_ngcontent-%COMP%]{position:absolute;height:100%;border-left:1px solid rgba(161,161,161,.75);top:42px}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .right-time-main[_ngcontent-%COMP%]   .status-container[_ngcontent-%COMP%]{display:flex;position:relative;height:32px;margin-bottom:20px}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .right-time-main[_ngcontent-%COMP%]   .status-container[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{height:32px;position:absolute;padding:5px 0;font-weight:bolder;text-align:center;border-radius:10px}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .right-time-main[_ngcontent-%COMP%]   .now-line[_ngcontent-%COMP%]{position:absolute;height:100%;border-left:2px dashed rgba(161,161,161,.75);top:42px}.session-container[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .right-time-main[_ngcontent-%COMP%]   .now-line[_ngcontent-%COMP%]   .now[_ngcontent-%COMP%]{position:absolute;top:-20px;left:-15px}"]}),s})()}]}];let D=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({providers:[n.Z],imports:[h.ez,P.x,x.u5,O.D,M.Bz.forChild(E)]}),s})()}}]);