"use strict";(self.webpackChunkst_admin=self.webpackChunkst_admin||[]).push([[6567],{64050:(F,A,r)=>{r.d(A,{F:()=>E}),r(38014);var h=r(3927),u=r(21086),o=r(27221),v=r(24850),B=r(86181),t=r(94650),C=r(80529),m=r(28555),b=r(91599);let E=(()=>{class M extends h.su{constructor(l,p,i){super(l,p),this.http=l,this.store=p,this.modelName="Driver",this.baseUrl="api/drivers",this.handleError=i.createHandleError(`${this.modelName}Service`)}getDriversSimpleList(l,p){const i=(0,B.U8)(`${this.baseUrl}`,{...l,...(0,B.jq)(p)});return this.get(this.getUrl(i)).pipe((0,o.K)(()=>(0,u.of)([]))).map(g=>Array.isArray(g)?(0,h.eC)(g):(0,h.O7)(g))}getModel(l){const p=this.getUrl(`api/users/${l}`);return this.get(p).map(i=>({...i,mobile:i.mobile||{},address:i.address||{}}))}createModel(l){const p=this.getUrl("api/register");return this.post(p,l)}updateModel(l){const p=this.getUrl("api/users/");return this.put(p,l)}deleteModel(l){const p=this.getUrl(`api/users/${l}`);return this.delete(p)}searchModel(l){const p=this.getUrl(`carpark/api/drivers/filter/${l||""}`);return this.get(p).pipe((0,v.U)(i=>i.content),(0,o.K)(()=>(0,u.of)([])))}getByCode(l){const p=this.getUrl(`carpark/api/drivers/${l}`);return this.get(p).pipe((0,o.K)(()=>(0,u.of)({})))}createModelApplication(l){const p=this.getUrl(`carpark/api/drivers/${l.driverCode}/seasons/applications`);return this.post(p,l)}getSimpleList(){return this.get(this.getUrl("carpark/api/drivers/simple-drivers-list"))}getEnforcementList(){return this.get(this.getUrl("carpark/api/drivers/enforcement"))}createAccount(l,p){const i=this.getUrl("api/register");return this.post(i,{hpNumber:l,password:p})}activeAccount(l,p){const i=this.getUrl("api/account/SMS_activate");return this.post(i,{hpNumber:l,key:p})}getBatchUser(l){return this.get(this.getUrl(`carpark/api/batch/user/info?status=${l}&size=99999`))}putBatchUser(l,p,i){const g=this.getUrl("carpark/api/batch/user/info");return this.put(g,{id:l,status:p,remarks:i})}}return M.\u0275fac=function(l){return new(l||M)(t.LFG(C.eN),t.LFG(m.yh),t.LFG(b.k))},M.\u0275prov=t.Yz7({token:M,factory:M.\u0275fac}),M})()},73071:(F,A,r)=>{r.d(A,{K:()=>B});var _=r(3927),h=r(94650),u=r(80529),o=r(28555),v=r(91599);let B=(()=>{class t extends _.su{constructor(m,b,E){super(m,b),this.http=m,this.store=b,this.modelName="User",this.baseUrl="",this.handleError=E.createHandleError(`${this.modelName}Service`)}searchOwners(m){const b=this.getUrl("carpark/api/car-park-owners");return this.get(b)}searchOperators(m){const b=this.getUrl("carpark/api/car-park-operators");return this.get(b)}}return t.\u0275fac=function(m){return new(m||t)(h.LFG(u.eN),h.LFG(o.yh),h.LFG(v.k))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t})()},52746:(F,A,r)=>{r.d(A,{t:()=>o});var _=r(72986),h=r(591),u=r(94650);let o=(()=>{class v{constructor(){this.loading=!1,this.pagination={totalCount:0,rowsPerPage:20,page:1,sortBy:null,descending:!0,totalPages:1},this.listData=[],this.hadGetData$=new h.X(!1)}get hadGetData(){return this.hadGetData$.getValue()}get filterParams(){return this._filterParams}set filterParams(t){this._filterParams=t}reloadDataService(t,C="filterModel"){this.loading=!0,this.hadGetData$.next(!1),t[C](this.filterParams,this.pagination).pipe((0,_.q)(1)).subscribe(m=>{if(m.pagination.page>m.pagination.totalPages)return this.pagination={...this.pagination,page:m.pagination.totalPages},this.reloadDataService(t);this.loading=!1,this.pagination={...this.pagination,totalCount:m.pagination.totalCount||m.pagination.totalElements},this.listData=m.data,this.hadGetData$.next(!0)},()=>{this.loading=!1,this.listData=[],this.pagination={...this.pagination,totalCount:0}})}onQueryParamsChange(t){const{pageSize:C,pageIndex:m}=t;this.pagination={...this.pagination,rowsPerPage:C,page:m},this.reloadData()}reloadData(){}ngOnInit(){}}return v.\u0275fac=function(t){return new(t||v)},v.\u0275cmp=u.Xpm({type:v,selectors:[["ng-component"]],decls:0,vars:0,template:function(t,C){},encapsulation:2}),v})()},76916:(F,A,r)=>{r.d(A,{G:()=>y});var _=r(34793),h=r(92198),u=r(38014),o=r(94650),v=r(89383),B=r(60097),t=r(36895);function C(l,p){if(1&l&&(o.TgZ(0,"a",14)(1,"span",15),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&l){const i=o.oxw().$implicit;o.xp6(2),o.hij(" ",o.lcZ(3,1,i.label)," ")}}function m(l,p){if(1&l&&(o.TgZ(0,"a",16)(1,"span",15),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&l){const i=o.oxw(),g=i.$implicit,f=i.last,T=o.oxw(2);o.Q6J("routerLink",g.url)("queryParams",f&&T.route.snapshot.queryParams),o.xp6(2),o.hij(" ",o.lcZ(3,3,g.label)," ")}}function b(l,p){if(1&l&&(o.ynx(0),o.TgZ(1,"li",10)(2,"span"),o._uU(3," > "),o.qZA()(),o.TgZ(4,"li",11),o.YNc(5,C,4,3,"a",12),o.YNc(6,m,4,5,"a",13),o.qZA(),o.BQk()),2&l){const i=p.first;o.xp6(5),o.Q6J("ngIf",i),o.xp6(1),o.Q6J("ngIf",!i)}}function E(l,p){if(1&l){const i=o.EpF();o.TgZ(0,"div",1)(1,"div",2)(2,"div",3),o._UZ(3,"h3",4),o.TgZ(4,"ul",5)(5,"li",6)(6,"a",7),o.NdJ("click",function(){o.CHM(i);const f=o.oxw();return o.KtG(f.jumpHome())}),o._UZ(7,"i",8),o.qZA()(),o.YNc(8,b,7,2,"ng-container",9),o.qZA()(),o.TgZ(9,"div"),o.Hsn(10),o.qZA()()()}if(2&l){const i=o.oxw();o.xp6(3),o.Q6J("innerHTML",i.title,o.oJD),o.xp6(5),o.Q6J("ngForOf",i.breads)}}const M=["*"];let y=(()=>{class l{constructor(i,g,f,T){this.router=i,this.route=g,this.translate=f,this._carparkService=T,this.breads=[],this.loginUser=""}ngOnInit(){let i=JSON.parse(localStorage.getItem("user-roles"))[0];this.loginUser=i,console.log(this.loginUser,"\u4fe1\u606f"),this.breads=this.buildBreadCrumb(this.route.root),this.translate.get(this.breads[0].label).subscribe(f=>{this.label=f}),this.router.events.pipe((0,h.h)(f=>f instanceof _.m2)).subscribe(()=>{this.breads=this.buildBreadCrumb(this.route.root)})}buildBreadCrumb(i,g=[""],f=[]){const T=i.snapshot.url[0]&&i.snapshot.url[0].path,O=[...g,T],D={...this.extractBreadcrumb(i),url:O},L=T&&D.label?[...f,D]:f;return this.title=D.title||this.title||"",this.isMotorist&&"My Vehicle(s)"===D.label&&(this.title="My Vehicle(s)"),i.firstChild?T?this.buildBreadCrumb(i.firstChild,O,L):this.buildBreadCrumb(i.firstChild,g,f):(this.translate.get(this.title).subscribe(Z=>{this.title=Z}),L)}get isMotorist(){return this._carparkService.isMotorist()}extractBreadcrumb(i){return i.snapshot.data.breadcrumb instanceof Function?i.snapshot.data.breadcrumb(i):i.snapshot.data.breadcrumb}jumpHome(){let i=JSON.parse(localStorage.getItem("user-roles"))[0]??"";this.router.navigate(i.length?[u.gpL[i]]:["/"])}}return l.\u0275fac=function(i){return new(i||l)(o.Y36(_.F0),o.Y36(_.gz),o.Y36(v.sK),o.Y36(B.x))},l.\u0275cmp=o.Xpm({type:l,selectors:[["app-title-bar"]],ngContentSelectors:M,decls:1,vars:1,consts:[["class","m-subheader",4,"ngIf"],[1,"m-subheader"],[1,"d-flex","align-items-center"],[1,"mr-auto"],[1,"m-subheader__title","m-subheader__title--separator","text-main",3,"innerHTML"],[1,"m-subheader__breadcrumbs","m-nav","m-nav--inline"],[1,"m-nav__item","m-nav__item--home"],[1,"m-nav__link","m-nav__link--icon",3,"click"],[1,"m-nav__link-icon","la","la-home"],[4,"ngFor","ngForOf"],[1,"m-nav__separator"],[1,"m-nav__item"],["class","m-nav__link",4,"ngIf"],["class","m-nav__link",3,"routerLink","queryParams",4,"ngIf"],[1,"m-nav__link"],[1,"m-nav__link-text"],[1,"m-nav__link",3,"routerLink","queryParams"]],template:function(i,g){1&i&&(o.F$t(),o.YNc(0,E,11,2,"div",0)),2&i&&o.Q6J("ngIf","ROLE_TPO_PARTNER"!==g.loginUser)},dependencies:[t.sg,t.O5,_.yS,v.X$],encapsulation:2}),l})()},26567:(F,A,r)=>{r.r(A),r.d(A,{BroadcastModule:()=>Mt,createTranslateLoader:()=>q});var _=r(36895),h=r(80529),u=r(24006),o=r(34793),v=r(372),B=r(72986),t=r(94650),C=r(86181),m=r(3927),b=r(27221),E=r(28555),M=r(91599);let y=(()=>{class a extends m.su{constructor(e,n,s){super(e,n),this.http=e,this.store=n,this.modelName="Broadcast",this.handleError=s.createHandleError(`${this.modelName}Service`)}filterModel(e,n){const s=this.getUrl((0,C.U8)("carpark/api/broadcast-messagings/get-messages",{...e,...(0,C.jq)(n)}));return this.get(s).pipe((0,b.K)(this.handleError(`${this.modelName}Filter`,{}))).map(c=>Array.isArray(c)?(0,m.eC)(c):(0,m.O7)(c))}createModel(e,n){let s="";return s=this.getUrl("Individual"==n.type?`carpark/api/broadcast-messagings/${e}`:"All"==n.type?"carpark/api/bulksend-broadcast-messages":"carpark/api/season-broadcast-messages"),this.post(s,n).pipe((0,b.K)(this.handleError(`${this.modelName}Create`,{})))}approve(e){return this.get(this.getUrl(`carpark/api/broadcast-messagings/${e}/approve`))}getModel(e){const n=this.getUrl(`carpark/api/broadcast-messagings/${e}`);return this.get(n)}updateModel(e){const n=this.getUrl("carpark/api/broadcast-messagings");return this.put(n,e)}deleteModel(e){const n=this.getUrl(`carpark/api/broadcast-messagings/${e}`);return this.delete(n)}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(h.eN),t.LFG(E.yh),t.LFG(M.k))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})(),l=(()=>{class a{constructor(e,n){this.broadcastService=e,this.router=n}resolve(e){return this.broadcastService.getModel(e.paramMap.get("login")).pipe((0,B.q)(1))}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(y),t.LFG(o.F0))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})();var p=r(42684),i=r(64050),g=r(30329),f=r(59501),T=r(59245),O=r(21532),D=r(73071),L=r(88796),Z=r(89383),Y=r(19832);function V(a){return new Y.w(a,"../assets/i18n/",".json")}let X=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[M.k,p.e,D.K,i.F],imports:[o.Bz,_.ez,O.x,u.u5,g.D,T.mr,v.kn,L.A0,Z.aw.forChild({loader:{provide:Z.Zw,useFactory:V,deps:[h.eN]}})]}),a})();var tt=r(15439),P=r(70853),J=r(76916),I=r(38014),j=r(8929),K=r(35635),Q=r(66616),$=r(47044),H=r(21811),R=r(38231),w=r(48521);function et(a,d){if(1&a&&(t.TgZ(0,"div",25)(1,"div",26)(2,"div",27)(3,"h3",28),t._uU(4),t.ALo(5,"translate"),t.qZA()()()()),2&a){const e=t.oxw();t.xp6(4),t.AsE(" ",t.lcZ(5,2,"BroadCast ID"),": ",e.form.id," ")}}function at(a,d){if(1&a&&(t.TgZ(0,"label",29),t._uU(1),t.qZA()),2&a){const e=d.$implicit;t.Q6J("nzValue",e.text),t.xp6(1),t.Oqu(e.text)}}function nt(a,d){1&a&&t._UZ(0,"i",36)}function ot(a,d){1&a&&(t.TgZ(0,"div",37),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Field is required.")," "))}function rt(a,d){if(1&a){const e=t.EpF();t.TgZ(0,"div",4)(1,"label",5)(2,"span",6),t._uU(3,"*"),t.qZA(),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",11)(7,"div",30)(8,"input",31,32),t.NdJ("ngModelChange",function(s){t.CHM(e);const c=t.oxw();return t.KtG(c.mobileNo=s)})("ngModelChange",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.validateDriver(s.mobileNo))}),t.qZA(),t.TgZ(10,"span",33)(11,"span"),t.YNc(12,nt,1,0,"i",34),t.qZA()()(),t.YNc(13,ot,3,3,"div",35),t.qZA()()}if(2&a){const e=t.MAs(9),n=t.oxw();t.xp6(4),t.hij(" ",t.lcZ(5,4,"Broadcast To"),": "),t.xp6(4),t.Q6J("ngModel",n.mobileNo),t.xp6(4),t.Q6J("ngIf",n.visiable),t.xp6(1),t.Q6J("ngIf",e.invalid&&(e.dirty||e.touched))}}function st(a,d){1&a&&(t.TgZ(0,"div",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Field is required.")," "))}function it(a,d){1&a&&(t.TgZ(0,"div",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Field is required.")," "))}function lt(a,d){1&a&&(t.TgZ(0,"div",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Field is required.")," "))}let k=(()=>{class a{constructor(e,n,s,c,x){this.router=e,this.driverService=n,this.broadcastService=s,this.translate=c,this.busService=x,this.canceled=new t.vpe,this.submitted=new t.vpe,this.form=(0,I.o4S)(),this.identityTypeOptions=I.KiP,this.driverInput$=new j.xQ,this.selectBroadCastType="Individual",this.visiable=!1,this.broadCastType=[{text:"All"},{text:"Season"},{text:"Individual"}],this.busAdminBroadCastType=[{text:"Individual"}]}ngOnInit(){this.form=this.form||(0,I.o4S)(),this.busService.isBusAdmin()&&(this.broadCastType=this.busAdminBroadCastType)}cancel(){this.canceled.emit()}submit(){let e="Individual"!==this.selectBroadCastType;e&&(this.driver=null),this.submitted.emit({...this.form,driverCode:this.driver?this.driver.userName:"",driver:e?{}:this.driver,type:this.selectBroadCastType})}displayDriverOption(e){return[[e.firstName,e.lastName].filter(s=>s).join(" "),e.mobile,e.email].filter(s=>s&&s.length).join(", ")}changeBroadCastType(e){this.selectBroadCastType=e}validateDriver(e){this.visiable=!1,this.driver=null,e.length>=8&&this.driverService.searchModel(e).subscribe(n=>{n.length&&(this.visiable=!0,this.driver=n[0])})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(o.F0),t.Y36(i.F),t.Y36(y),t.Y36(Z.sK),t.Y36(P.Z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-broadcast-form"]],inputs:{form:"form",item:"item"},outputs:{canceled:"canceled",submitted:"submitted"},decls:55,vars:29,consts:[[1,"m-form","m-form--fit","m-form--label-align-right"],[1,"m-portlet"],["class","m-portlet__head",4,"ngIf"],[1,"m-portlet__body"],[1,"row","form-group","m-form__group"],[1,"col-form-label","col-lg-2","col-sm-12"],[1,"m--font-danger"],[1,"col-lg-6","col-sm-12","d-flex","align-items-center"],["name","type",3,"ngModel","ngModelChange"],["nz-radio","",3,"nzValue",4,"ngFor","ngForOf"],["class","row form-group m-form__group",4,"ngIf"],[1,"col-lg-4","col-sm-12"],["nzPlaceHolder","Please Select",2,"width","100%",3,"name","ngModel","ngModelChange"],["message_type","ngModel"],["nzValue","Announcement","nzLabel","Announcement"],["nzValue","Promotion","nzLabel","Promotion"],["class","form-control-feedback",4,"ngIf"],["nz-input","","type","text","name","message_subject","placeholder","Message Subject","required","",3,"ngModel","ngModelChange"],["message_subject","ngModel"],["nz-input","","name","message_content","placeholder","Message Content","required","","rows","5","cols","33",3,"ngModel","ngModelChange"],["message_content","ngModel"],[1,"m-portlet__foot","bg-light-gray"],[1,"m-form__actions","m-form__actions--right"],["nz-button","","nzType","primary","nzSize","large","nzGhost","",1,"btn-form-ops",3,"click"],["nz-button","","nzType","primary","nzSize","large",1,"btn-form-ops","m--margin-left-30",3,"click"],[1,"m-portlet__head"],[1,"m-portlet__head-caption"],[1,"m-portlet__head-title"],[1,"m-portlet__head-text"],["nz-radio","",3,"nzValue"],[1,"m-input-icon","m-input-icon--right"],["nz-input","","type","text","name","driverControl","placeholder","Broadcast To","required","",3,"ngModel","ngModelChange"],["driver","ngModel"],[1,"m-input-icon__icon","m-input-icon__icon--right"],["class","fa fa-check",4,"ngIf"],["class","form-control-feedback","style","color: #f4516c;",4,"ngIf"],[1,"fa","fa-check"],[1,"form-control-feedback",2,"color","#f4516c"],[1,"form-control-feedback"]],template:function(e,n){if(1&e&&(t.TgZ(0,"form",0)(1,"div",1),t.YNc(2,et,6,4,"div",2),t.TgZ(3,"div",3)(4,"div",4)(5,"label",5)(6,"span",6),t._uU(7,"*"),t.qZA(),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"div",7)(11,"nz-radio-group",8),t.NdJ("ngModelChange",function(c){return n.selectBroadCastType=c}),t.YNc(12,at,2,2,"label",9),t.qZA()()(),t.YNc(13,rt,14,6,"div",10),t.TgZ(14,"div",4)(15,"label",5)(16,"span",6),t._uU(17,"*"),t.qZA(),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"div",11)(21,"nz-select",12,13),t.NdJ("ngModelChange",function(c){return n.form.message_type=c}),t._UZ(23,"nz-option",14)(24,"nz-option",15),t.qZA(),t.YNc(25,st,3,3,"div",16),t.qZA()(),t.TgZ(26,"div",4)(27,"label",5)(28,"span",6),t._uU(29,"*"),t.qZA(),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"div",11)(33,"input",17,18),t.NdJ("ngModelChange",function(c){return n.form.message_subject=c}),t.qZA(),t.YNc(35,it,3,3,"div",16),t.qZA()(),t.TgZ(36,"div",4)(37,"label",5)(38,"span",6),t._uU(39,"*"),t.qZA(),t._uU(40),t.ALo(41,"translate"),t.qZA(),t.TgZ(42,"div",11)(43,"textarea",19,20),t.NdJ("ngModelChange",function(c){return n.form.message_content=c}),t._uU(45,"          "),t.qZA(),t.YNc(46,lt,3,3,"div",16),t.qZA()()(),t.TgZ(47,"div",21)(48,"div",22)(49,"button",23),t.NdJ("click",function(){return n.cancel()}),t._uU(50),t.ALo(51,"translate"),t.qZA(),t.TgZ(52,"button",24),t.NdJ("click",function(){return n.submit()}),t._uU(53),t.ALo(54,"translate"),t.qZA()()()()()),2&e){const s=t.MAs(22),c=t.MAs(34),x=t.MAs(44);t.xp6(2),t.Q6J("ngIf",n.form),t.xp6(6),t.hij(" ",t.lcZ(9,17,"BroadCast Type"),": "),t.xp6(3),t.Q6J("ngModel",n.selectBroadCastType),t.xp6(1),t.Q6J("ngForOf",n.broadCastType),t.xp6(1),t.Q6J("ngIf","Individual"===n.selectBroadCastType),t.xp6(5),t.hij(" ",t.lcZ(19,19,"Message Type"),": "),t.xp6(3),t.MGl("name","message_type",n.i,""),t.Q6J("ngModel",n.form.message_type),t.xp6(4),t.Q6J("ngIf",s.invalid&&(s.dirty||s.touched)),t.xp6(5),t.hij(" ",t.lcZ(31,21,"Message Subject"),": "),t.xp6(3),t.Q6J("ngModel",n.form.message_subject),t.xp6(2),t.Q6J("ngIf",c.invalid&&(c.dirty||c.touched)),t.xp6(5),t.hij(" ",t.lcZ(41,23,"Message Content"),": "),t.xp6(3),t.Q6J("ngModel",n.form.message_content),t.xp6(3),t.Q6J("ngIf",x.invalid&&(x.dirty||x.touched)),t.xp6(4),t.hij(" ",t.lcZ(51,25,"Cancel")," "),t.xp6(3),t.hij(" ",t.lcZ(54,27,"Submit")," ")}},dependencies:[_.sg,_.O5,K.Zp,Q.ix,$.w,H.dQ,R.Ip,R.Vq,w.Of,w.Dg,u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.On,u.F,Z.X$],encapsulation:2}),a})(),ct=(()=>{class a{constructor(e,n,s,c){this.router=e,this.broadcastService=n,this.translate=s,this.busService=c}ngOnInit(){}cancel(){this.router.navigate([this.busService.isBusAdmin()?"/bus-broadcast":"/broadcast"])}submit(e){let{message_content:n,message_subject:s,message_type:c,driverCode:x,id:z,type:N}=e;const S={approvalDateTime:"",approvedBy:"",createdBy:"",createdDateTime:tt().format("YYYY-MM-DDTHH:mm:ssZ"),driverCode:x,id:z,messageContent:n,messageSubject:s,messageType:c,status:"",type:N};this.broadcastService.createModel(e.driverCode,"Individual"!==e.type?S:e).subscribe(()=>{this.cancel()})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(o.F0),t.Y36(y),t.Y36(Z.sK),t.Y36(P.Z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-broadcast-create"]],decls:4,vars:0,consts:[[1,"body-wrapper"],[1,"m-content"],[3,"canceled","submitted"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-title-bar"),t.TgZ(2,"div",1)(3,"app-broadcast-form",2),t.NdJ("canceled",function(){return n.cancel()})("submitted",function(c){return n.submit(c)}),t.qZA()()())},dependencies:[J.G,k],encapsulation:2}),a})();r(79118);var dt=r(52746),pt=r(47423),G=r(73325),W=r(29562),U=r(40269);function mt(a,d){if(1&a){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.gotoCreate())}),t._UZ(1,"span",16),t._uU(2,"Create Broadcast "),t.qZA()}}function ut(a,d){if(1&a&&t._uU(0),2&a){const e=d.range;t.lnq(" ",e[0],"-",e[1]," of ",d.$implicit," items ")}}function gt(a,d){if(1&a&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&a){const e=d.$implicit;t.xp6(1),t.Oqu(e.text)}}function _t(a,d){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",21),t._UZ(2,"i",22),t.qZA(),t.TgZ(3,"nz-dropdown-menu",null,23)(5,"ul",24)(6,"li",25),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2).$implicit,c=t.oxw();return t.KtG(c.gotoUpdate(s.id))}),t._UZ(7,"i",26),t.TgZ(8,"span"),t._uU(9),t.ALo(10,"translate"),t.qZA()(),t.TgZ(11,"li",25),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2).$implicit,c=t.oxw();return t.KtG(c.approve(s.id))}),t._UZ(12,"i",27),t.TgZ(13,"span"),t._uU(14),t.ALo(15,"translate"),t.qZA()()()(),t.BQk()}if(2&a){const e=t.MAs(4);t.xp6(1),t.Q6J("nzDropdownMenu",e)("nzPlacement","topCenter"),t.xp6(8),t.Oqu(t.lcZ(10,4,"Edit Message")),t.xp6(5),t.Oqu(t.lcZ(15,6,"Approve"))}}function ht(a,d){if(1&a&&(t.ynx(0),t.YNc(1,_t,16,8,"ng-container",18),t.BQk()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf","Pending"===e.status)}}function vt(a,d){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr")(2,"td",17),t.NdJ("nzExpandChange",function(s){const x=t.CHM(e).$implicit,z=t.oxw();return t.KtG(z.onExpandChange(x.id,s))}),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"date"),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.TgZ(14,"td"),t.YNc(15,ht,2,1,"ng-container",18),t.qZA()(),t.TgZ(16,"tr",19)(17,"nz-table",20)(18,"thead")(19,"tr")(20,"th"),t._uU(21),t.ALo(22,"translate"),t.qZA()()(),t.TgZ(23,"tbody")(24,"tr")(25,"td"),t._uU(26),t.qZA()()()()(),t.BQk()}if(2&a){const e=d.$implicit,n=d.index,s=t.oxw();t.xp6(1),t.ekj("ant-table-row-odd",n%2==1),t.xp6(1),t.Q6J("nzExpand",s.expandSet.has(e.id)),t.xp6(2),t.Oqu(e.id),t.xp6(2),t.hij("",s.displayName(e)," "),t.xp6(2),t.Oqu(t.xi3(9,13,e.created_datetime,"d LLL yyyy")),t.xp6(3),t.Oqu(e.message_subject),t.xp6(2),t.Oqu(e.approved_by),t.xp6(2),t.Q6J("ngIf","ROLE_CPO_USER"!==s.loginRole),t.xp6(1),t.Q6J("nzExpand",s.expandSet.has(e.id)),t.xp6(1),t.Q6J("nzShowPagination",!1),t.xp6(4),t.Oqu(t.lcZ(22,16,"Message Content")),t.xp6(5),t.hij(" ",e.message_content||"-"," ")}}let ft=(()=>{class a extends dt.t{constructor(e,n,s,c){super(),this.router=e,this.broadcastService=n,this.translate=s,this.busService=c,this.data=[],this.pagination=(0,C.f$)(),this.keyword="",this.keyword$=new j.xQ,this.tableHeaders=[{text:"ID",column:"id",width:"50px"},{text:"Broadcast To",column:"driverId",width:"150px"},{text:"Created Date",column:"created_date",width:"150px"},{text:"Subject",column:"message_subject",width:"150px"},{text:"Approve",column:"status",width:"80px"},{text:"Actions",width:"80px"}],this.loginRole="",this.approving={},this.expandSet=new Set;const x=this.tableHeaders.map(z=>z.text);this.translate.get(x).subscribe(z=>{this.tableHeaders.forEach(N=>{for(let S in z)z.hasOwnProperty(S)&&N.text===S&&(N.text=z[S])})})}gotoCreate(){this.router.navigate([this.busService.isBusAdmin()?"/bus-broadcast/create":"/broadcast/create"])}gotoUpdate(e){this.router.navigate([this.busService.isBusAdmin()?`/bus-broadcast/${e}/update`:`/broadcast/${e}/update`])}get filterParams(){return{key:this.keyword,sort:"id,desc"}}reloadData(){this.reloadDataService(this.broadcastService)}pageChanged(e){this.pagination=e,this.reloadData()}displayName(e){return e?(0,I.ssW)(e):""}approve(e){this.approving[e]=!0,this.broadcastService.approve(e).subscribe(()=>this.reloadData(),null,()=>this.approving[e]=!1)}ngOnInit(){this.keyword$.debounceTime(500).subscribe(()=>{this.reloadData()}),this.reloadData(),this.loginRole=JSON.parse(localStorage.getItem("user-roles"))[0]}onExpandChange(e,n){n?this.expandSet.add(e):this.expandSet.delete(e)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(o.F0),t.Y36(y),t.Y36(Z.sK),t.Y36(P.Z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-broadcast-home"]],features:[t.qOj],decls:23,vars:12,consts:[[1,"body-wrapper"],["nz-button","","nzType","primary","nzShape","round","nzSize","large",3,"click",4,"ngIf"],[1,"m-content"],[1,"m-portlet","m-portlet--bordered-semi","m--padding-top-40"],[1,"m-portlet__body"],[1,"row","form-group","m-form__group"],[1,"col-form-label"],[1,"col-lg-3"],[1,"m-input-icon","m-input-icon--left"],["type","text","nz-input","","placeholder","Message Subject",3,"ngModel","ngModelChange"],["rangeTemplate",""],[3,"nzData","nzFrontPagination","nzLoading","nzTotal","nzPageSize","nzPageIndex","nzShowSizeChanger","nzShowTotal","nzQueryParams"],["basicTable",""],["nzWidth","60px"],[4,"ngFor","ngForOf"],["nz-button","","nzType","primary","nzShape","round","nzSize","large",3,"click"],["nz-icon","","nzType","plus","nzTheme","outline"],[3,"nzExpand","nzExpandChange"],[4,"ngIf"],[3,"nzExpand"],["nzSize","small","nzTemplateMode","",3,"nzShowPagination"],["nz-dropdown","","nzTrigger","click",1,"btn","btn-outline-primary","m-btn","m-btn--icon","m-btn--icon-only","m-btn--custom","m-btn--outline-2x","m-btn--pill","no-border",3,"nzDropdownMenu","nzPlacement"],[1,"la","la-ellipsis-h"],["menu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"],[1,"la","la-edit",2,"margin-right","4px"],[1,"la","la-check",2,"margin-right","4px"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"app-title-bar"),t.YNc(2,mt,3,0,"button",1),t.qZA(),t.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"label",6),t._uU(8," Message Subject: "),t.qZA(),t.TgZ(9,"div",7)(10,"div",8)(11,"input",9),t.NdJ("ngModelChange",function(c){return n.keyword=c})("ngModelChange",function(c){return n.keyword$.next(c)}),t.qZA()()()(),t.YNc(12,ut,1,3,"ng-template",null,10,t.W1O),t.TgZ(14,"nz-table",11,12),t.NdJ("nzQueryParams",function(c){return n.onQueryParamsChange(c)}),t.TgZ(16,"thead")(17,"tr")(18,"th",13),t._uU(19,"#"),t.qZA(),t.YNc(20,gt,2,1,"th",14),t.qZA()(),t.TgZ(21,"tbody"),t.YNc(22,vt,27,18,"ng-container",14),t.qZA()()()()()()),2&e){const s=t.MAs(13),c=t.MAs(15);t.xp6(2),t.Q6J("ngIf","ROLE_CPO_USER"!==n.loginRole),t.xp6(9),t.Q6J("ngModel",n.keyword),t.xp6(3),t.Q6J("nzData",n.listData)("nzFrontPagination",!1)("nzLoading",n.loading)("nzTotal",n.pagination.totalCount)("nzPageSize",n.pagination.rowsPerPage)("nzPageIndex",n.pagination.page)("nzShowSizeChanger",!0)("nzShowTotal",s),t.xp6(6),t.Q6J("ngForOf",n.tableHeaders),t.xp6(2),t.Q6J("ngForOf",c.data)}},dependencies:[_.sg,_.O5,u.Fj,u.JJ,u.On,J.G,K.Zp,pt.Ls,G.wO,G.r9,W.cm,W.RR,Q.ix,$.w,H.dQ,U.N8,U.Uo,U._C,U.h7,U.Om,U.p0,U.$Z,U.d3,U.Vk,_.uU,Z.X$],encapsulation:2}),a})();function Ct(a,d){if(1&a){const e=t.EpF();t.TgZ(0,"ul",7)(1,"li",8)(2,"a",9),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.delete())}),t._UZ(3,"i",10),t.TgZ(4,"span"),t._uU(5,"Delete Message"),t.qZA()()()()}}let bt=(()=>{class a{constructor(e,n,s,c,x){this.router=e,this.route=n,this.broadcastService=s,this.translate=c,this.busService=x}ngOnInit(){this.item=this.route.snapshot.data.broadcast}delete(){this.broadcastService.deleteModel(this.item.id).subscribe(()=>{this.cancel()})}cancel(){this.router.navigate([this.busService.isBusAdmin()?"/bus-broadcast":"/broadcast"])}submit(e){this.broadcastService.updateModel(e).subscribe(()=>{this.cancel()})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(o.F0),t.Y36(o.gz),t.Y36(y),t.Y36(Z.sK),t.Y36(P.Z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-broadcast-update"]],decls:8,vars:1,consts:[[1,"body-wrapper"],["dropdown","",1,"m-dropdown","m-dropdown--inline"],["dropdownToggle","",1,"btn","btn-outline-main","m-btn","m-btn--icon","m-btn--icon-only","m-btn--custom","m-btn--pill","m-btn--air"],[1,"la","la-ellipsis-h"],["class","dropdown-menu dropdown-menu-right","role","menu",4,"dropdownMenu"],[1,"m-content"],[3,"form","canceled","submitted"],["role","menu",1,"dropdown-menu","dropdown-menu-right"],["role","menuitem"],[1,"dropdown-item",3,"click"],[1,"la","la-trash"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"app-title-bar")(2,"div",1)(3,"button",2),t._UZ(4,"i",3),t.qZA(),t.YNc(5,Ct,6,0,"ul",4),t.qZA()(),t.TgZ(6,"div",5)(7,"app-broadcast-form",6),t.NdJ("canceled",function(){return n.cancel()})("submitted",function(c){return n.submit(c)}),t.qZA()()()),2&e&&(t.xp6(7),t.Q6J("form",n.item))},dependencies:[J.G,T.Hz,T.Mq,T.TO,k],encapsulation:2}),a})();var Tt=r(60097);function q(a){return new Y.w(a,"../assets/i18n/",".json")}const xt=[{path:"",component:f.f,children:[{path:"",component:ft},{path:"create",component:ct,data:{breadcrumb:{label:"Create"}}},{path:":login/update",resolve:{broadcast:l},component:bt}]}];let Mt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[M.k,p.e,y,l,i.F,Tt.x,P.Z],imports:[_.ez,u.u5,o.Bz.forChild(xt),O.x,g.D,T.mr,v.kn,X,Z.aw.forChild({loader:{provide:Z.Zw,useFactory:q,deps:[h.eN]}}),o.Bz]}),a})()}}]);