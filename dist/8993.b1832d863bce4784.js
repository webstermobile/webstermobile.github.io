"use strict";(self.webpackChunkst_admin=self.webpackChunkst_admin||[]).push([[8993],{76284:(R,A,n)=>{n.d(A,{z:()=>O});var g=n(3927),C=n(94650),E=n(80529),o=n(28555),Z=n(11481),x=n(91599);let O=(()=>{class y extends g.su{constructor(p,v,f,M){super(p,v),this.http=p,this.store=v,this.sanitizer=f,this.modelName="User",this.baseUrl="",this.handleError=M.createHandleError(`${this.modelName}Service`)}uploadImage(p){const v=this.getUrl("carpark/api/assets/img"),f=new FormData;return f.append("file",p,p.name),this.post(v,f).map(({uuid:M})=>this.getImage(M))}getImage(p){return this.getUrl(`carpark/api/resources/${p}`)}getImageByUuid(p,v){return this.get(this.getUrl(`carpark/api/resources/${p}`),{responseType:"blob"}).map(f=>v?this._getSafeFileUrl(f):this.getSafeFileUrl(f))}getSafeFileUrl(p){return this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(p))}_getSafeFileUrl(p){return{imgUrl:this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(p)),type:p.type}}requestSessionImage(p,v){const f=this.getUrl(`carpark/api/anpr/request/${p}/${v}`);return this.get(f,{responseType:"text"})}getSessionImage(p){return this.get(this.getUrl(`carpark/api/anpr/assets/${p}/1`),{responseType:"blob"}).map(v=>this.getSafeFileUrl(v))}}return y.\u0275fac=function(p){return new(p||y)(C.LFG(E.eN),C.LFG(o.yh),C.LFG(Z.H7),C.LFG(x.k))},y.\u0275prov=C.Yz7({token:y,factory:y.\u0275fac}),y})()},51766:(R,A,n)=>{n.d(A,{C:()=>v});var g=n(3927),C=n(86181),E=n(591),o=n(27221),Z=n(66708),x=n(94650),O=n(60097),y=n(28555),P=n(80529),p=n(91599);let v=(()=>{class f extends g.su{constructor(s,m,a,h){super(a,m),this.carparkService=s,this.store=m,this.http=a,this.$seasonData=new E.X({}),this.modelName="Carpark",this.handleError=h.createHandleError(`${this.modelName}Service`)}ngOnInit(){}handleDynamicUrl(){const s=JSON.parse(localStorage.getItem("user")).login;this.baseUrl=this.carparkService.isMotorist()&&Z.Z.isNotNull(s)?`carpark/api/drivers/${s}/seasons`:"carpark/api/season-parkings"}filterModel(s,m){return this.handleDynamicUrl(),super.filterModel(s,m).map(a=>a.data?a:{data:[],pagination:(0,C.f$)()})}filterModelOfCarpark(s,m,a){const h=this.getUrl((0,C.U8)(`carpark/api/season-parking/${s}/getList`,{...m,...(0,C.jq)(a)}));return this.get(h).pipe((0,o.K)(this.handleError(`${this.modelName}Filter`,{}))).map(u=>Array.isArray(u)?(0,g.eC)(u.slice(0,a.rowsPerPage+1)):(0,g.O7)(u))}filterModelOfVehicle(s,m,a){const h=this.getUrl((0,C.U8)(`carpark/api/vehicles/${s}/seasons`,{...m,...(0,C.jq)(a)}));return this.get(h).pipe((0,o.K)(this.handleError(`${this.modelName}Filter`,{}))).map(u=>Array.isArray(u)?(0,g.eC)(u.slice(0,a.rowsPerPage+1)):(0,g.O7)(u))}getIdentity(s){const m=this.getUrl(`carpark/api/seasons/applications/${s}`);return this.get(m)}downloadSessonPdf(s){const m=this.getUrl(`carpark/api/printBilling/seasoncode/pdf/${s}`);return this.get(m,{responseType:"blob"}).pipe((0,o.K)(this.handleError(`${this.modelName}Get`,{})))}getGroupSeason(s){const m=this.getUrl(`carpark/api/season-group/query/${s}`);return this.get(m)}applyHandle(s){return this.post(this.getUrl("carpark/api/season-group"),s)}clearHandle(s){return this.delete(this.getUrl(`carpark/api/season-group/clear/${s}`))}}return f.\u0275fac=function(s){return new(s||f)(x.LFG(O.x),x.LFG(y.yh),x.LFG(P.eN),x.LFG(p.k))},f.\u0275prov=x.Yz7({token:f,factory:f.\u0275fac}),f})()},76916:(R,A,n)=>{n.d(A,{G:()=>M});var g=n(34793),C=n(92198),E=n(38014),o=n(94650),Z=n(89383),x=n(60097),O=n(36895);function y(s,m){if(1&s&&(o.TgZ(0,"a",14)(1,"span",15),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&s){const a=o.oxw().$implicit;o.xp6(2),o.hij(" ",o.lcZ(3,1,a.label)," ")}}function P(s,m){if(1&s&&(o.TgZ(0,"a",16)(1,"span",15),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&s){const a=o.oxw(),h=a.$implicit,u=a.last,T=o.oxw(2);o.Q6J("routerLink",h.url)("queryParams",u&&T.route.snapshot.queryParams),o.xp6(2),o.hij(" ",o.lcZ(3,3,h.label)," ")}}function p(s,m){if(1&s&&(o.ynx(0),o.TgZ(1,"li",10)(2,"span"),o._uU(3," > "),o.qZA()(),o.TgZ(4,"li",11),o.YNc(5,y,4,3,"a",12),o.YNc(6,P,4,5,"a",13),o.qZA(),o.BQk()),2&s){const a=m.first;o.xp6(5),o.Q6J("ngIf",a),o.xp6(1),o.Q6J("ngIf",!a)}}function v(s,m){if(1&s){const a=o.EpF();o.TgZ(0,"div",1)(1,"div",2)(2,"div",3),o._UZ(3,"h3",4),o.TgZ(4,"ul",5)(5,"li",6)(6,"a",7),o.NdJ("click",function(){o.CHM(a);const u=o.oxw();return o.KtG(u.jumpHome())}),o._UZ(7,"i",8),o.qZA()(),o.YNc(8,p,7,2,"ng-container",9),o.qZA()(),o.TgZ(9,"div"),o.Hsn(10),o.qZA()()()}if(2&s){const a=o.oxw();o.xp6(3),o.Q6J("innerHTML",a.title,o.oJD),o.xp6(5),o.Q6J("ngForOf",a.breads)}}const f=["*"];let M=(()=>{class s{constructor(a,h,u,T){this.router=a,this.route=h,this.translate=u,this._carparkService=T,this.breads=[],this.loginUser=""}ngOnInit(){let a=JSON.parse(localStorage.getItem("user-roles"))[0];this.loginUser=a,console.log(this.loginUser,"\u4fe1\u606f"),this.breads=this.buildBreadCrumb(this.route.root),this.translate.get(this.breads[0].label).subscribe(u=>{this.label=u}),this.router.events.pipe((0,C.h)(u=>u instanceof g.m2)).subscribe(()=>{this.breads=this.buildBreadCrumb(this.route.root)})}buildBreadCrumb(a,h=[""],u=[]){const T=a.snapshot.url[0]&&a.snapshot.url[0].path,Y=[...h,T],I={...this.extractBreadcrumb(a),url:Y},D=T&&I.label?[...u,I]:u;return this.title=I.title||this.title||"",this.isMotorist&&"My Vehicle(s)"===I.label&&(this.title="My Vehicle(s)"),a.firstChild?T?this.buildBreadCrumb(a.firstChild,Y,D):this.buildBreadCrumb(a.firstChild,h,u):(this.translate.get(this.title).subscribe(J=>{this.title=J}),D)}get isMotorist(){return this._carparkService.isMotorist()}extractBreadcrumb(a){return a.snapshot.data.breadcrumb instanceof Function?a.snapshot.data.breadcrumb(a):a.snapshot.data.breadcrumb}jumpHome(){let a=JSON.parse(localStorage.getItem("user-roles"))[0]??"";this.router.navigate(a.length?[E.gpL[a]]:["/"])}}return s.\u0275fac=function(a){return new(a||s)(o.Y36(g.F0),o.Y36(g.gz),o.Y36(Z.sK),o.Y36(x.x))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-title-bar"]],ngContentSelectors:f,decls:1,vars:1,consts:[["class","m-subheader",4,"ngIf"],[1,"m-subheader"],[1,"d-flex","align-items-center"],[1,"mr-auto"],[1,"m-subheader__title","m-subheader__title--separator","text-main",3,"innerHTML"],[1,"m-subheader__breadcrumbs","m-nav","m-nav--inline"],[1,"m-nav__item","m-nav__item--home"],[1,"m-nav__link","m-nav__link--icon",3,"click"],[1,"m-nav__link-icon","la","la-home"],[4,"ngFor","ngForOf"],[1,"m-nav__separator"],[1,"m-nav__item"],["class","m-nav__link",4,"ngIf"],["class","m-nav__link",3,"routerLink","queryParams",4,"ngIf"],[1,"m-nav__link"],[1,"m-nav__link-text"],[1,"m-nav__link",3,"routerLink","queryParams"]],template:function(a,h){1&a&&(o.F$t(),o.YNc(0,v,11,2,"div",0)),2&a&&o.Q6J("ngIf","ROLE_TPO_PARTNER"!==h.loginUser)},dependencies:[O.sg,O.O5,g.yS,Z.X$],encapsulation:2}),s})()},98993:(R,A,n)=>{n.r(A),n.d(A,{WalletModule:()=>St,createTranslateLoader:()=>j});var g=n(36895),C=n(80529),E=n(24006),o=n(34793),Z=n(372),x=n(73897),O=n(76284),y=n(60097),P=n(36511),p=n(64050),v=n(91599),f=n(42684),M=n(51766),s=n(71942),m=n(30329),a=n(59501),h=n(49333),u=n(88796),T=n(20388),Y=n(59245),I=n(21532),D=n(4358),J=n(43056),F=n(94700),H=n(48568),V=n(29252),X=n(52885),S=n(66708),t=n(94650),N=n(89383),L=n(12719),q=n(11742),tt=n(76916),W=n(66616),w=n(47044),et=n(37570);function nt(i,d){if(1&i&&(t._UZ(0,"div",23),t.ALo(1,"translate")),2&i){const e=t.oxw(2);t.Q6J("innerHtml",t.lcZ(1,1,e.infoBill),t.oJD)}}const ot=function(){return["billing-history"]},rt=function(){return["card"]};function it(i,d){if(1&i&&(t.TgZ(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"ul",14)(5,"li",15)(6,"a",16),t._uU(7),t.ALo(8,"translate"),t.qZA()(),t.TgZ(9,"li",15)(10,"a",16),t._uU(11),t.ALo(12,"translate"),t.qZA()()()()(),t.TgZ(13,"div",17)(14,"div",18)(15,"a",19),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.YNc(18,nt,2,3,"ng-template",null,20,t.W1O),t.TgZ(20,"button",21),t._UZ(21,"i",22),t.qZA()()()()()),2&i){const e=t.MAs(19);t.xp6(6),t.Q6J("routerLink",t.DdM(14,ot))("routerLinkActive","active"),t.xp6(1),t.hij(" ",t.lcZ(8,8,"Billing History")," "),t.xp6(3),t.Q6J("routerLink",t.DdM(15,rt))("routerLinkActive","active"),t.xp6(1),t.hij(" ",t.lcZ(12,10,"Card")," "),t.xp6(5),t.hij("",t.lcZ(17,12,"What is a bill"),"?"),t.xp6(4),t.Q6J("nzTooltipTitle",e)}}let at=(()=>{class i{constructor(e,r,l){this.translate=e,this.location=r,this.walletService=l,this.togglePostPay=!0}ngOnInit(){this.onHandleInitialPostPay(),this.infoBill="infoBill"}get isTopup(){return"/wallet/topup"===this.location.path()}onTogglePostPay(e){this.onSettingPostPay(e),this.walletService.postPayToggle({code:"POST_PAY",groupCode:"SETTING",value:`${e}`}).subscribe(()=>{console.log("switched")},l=>console.log("switched error"))}onSettingPostPay(e){localStorage.setItem("togglePostPay",e)}onHandleInitialPostPay(){const e=localStorage.getItem("togglePostPay");S.Z.isNotNull(e)&&(this.togglePostPay=JSON.parse(e))}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(N.sK),t.Y36(g.Ye),t.Y36(L.X))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-wallet"]],decls:12,vars:2,consts:[[1,"body-wrapper"],[1,"m-content","m-content--wallet"],[1,"m-portlet","m-portlet--tabs"],[1,"col-lg-12"],[1,"row","ml-1","pt-4","pb-3"],[1,"col-lg-2"],[1,"row","ml-1"],["class","m-portlet__head py-0","style","height: 0;",4,"ngIf"],[1,"m-portlet__body","m-portlet__body--scrollable",3,"ngClass"],[1,"m-portlet__frame"],[1,"m-portlet__head","py-0",2,"height","0"],[1,"row"],[1,"col-lg-9"],[1,"m-portlet__head-tools"],["role","tablist",1,"nav","nav-tabs","m-tabs-line","m-tabs-line--primary","m-tabs-line--2x"],[1,"nav-item","m-tabs__item"],[1,"nav-link","m-tabs__link",3,"routerLink","routerLinkActive"],[1,"col-lg-3","mt-3","text-right"],[1,""],["href","#",1,"noTextDecoration"],["popTemplate",""],["nz-button","","nzType","link","type","button","nz-tooltip","",1,"py-0",3,"nzTooltipTitle"],[1,"la","la-info-circle","text-primary"],[3,"innerHtml"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-title-bar"),t.TgZ(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5),t._UZ(7,"div",6),t.qZA()()(),t.YNc(8,it,22,16,"div",7),t.TgZ(9,"div",8)(10,"div",9),t._UZ(11,"router-outlet"),t.qZA()()()()()),2&e&&(t.xp6(8),t.Q6J("ngIf",!r.isTopup),t.xp6(1),t.Q6J("ngClass",r.isTopup?"py-0":""))},dependencies:[g.mk,g.O5,o.lC,o.yS,o.Od,q.S,tt.G,W.ix,w.w,et.SY,N.X$],styles:[".m-content--wallet[_ngcontent-%COMP%]   .m-portlet.m-portlet--tabs[_ngcontent-%COMP%]   .m-portlet__head[_ngcontent-%COMP%]   .m-portlet__head-tools[_ngcontent-%COMP%]   .m-tabs-line[_ngcontent-%COMP%]   .m-tabs__link[_ngcontent-%COMP%]{padding:0 0 1rem!important}.m-content--wallet[_ngcontent-%COMP%]   .border-right-solid[_ngcontent-%COMP%]{border-right:1px solid #eaeaea}.m-content--wallet[_ngcontent-%COMP%]   .font-size-3rem[_ngcontent-%COMP%]{font-size:3rem!important}.m-tabs-line.m-tabs-line--primary[_ngcontent-%COMP%]   a.m-tabs__link.active[_ngcontent-%COMP%], .m-tabs-line.m-tabs-line--primary[_ngcontent-%COMP%]   a.m-tabs__link[_ngcontent-%COMP%]:hover{color:#f54b43;border-bottom:1px solid #f54b43}.topup-circle[_ngcontent-%COMP%]{border-radius:200px;-moz-border-radius:200px 200px 200px 200px;-webkit-border-radius:200px 200px 200px 200px;border:0px solid #f3e2e1;background-color:#fee4e3;width:100px;height:180px}.noTextDecoration[_ngcontent-%COMP%]{cursor:default;text-decoration:none}"]}),i})();var st=n(10054),G=n(21406),lt=n(2994),U=n(15439),Q=n(21837),K=n(38014),b=n(9648),ct=n(35635),dt=n(21811);const pt=["cardNumber"],mt=["cardNumberElementRef"],ut=["cardExpiryElementRef"],gt=["cardCVCElementRef"];function ht(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"div",30)(1,"alert",31),t.NdJ("onClosed",function(){const c=t.CHM(e).$implicit,_=t.oxw();return t.KtG(_.onClosed(c))}),t._uU(2),t.qZA()()}if(2&i){const e=d.$implicit;t.Q6J("hidden",!e.type),t.xp6(1),t.Q6J("type",e.type)("dismissOnTimeout",e.timeout),t.xp6(1),t.Oqu(e.msg)}}function ft(i,d){if(1&i&&(t.ynx(0),t._UZ(1,"input",32),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.MGl("value","\u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 ",null==e.accInformations?null:e.accInformations.cardNumber,""),t.Q6J("disabled",e.existAccount)}}function _t(i,d){if(1&i&&t._UZ(0,"input",33),2&i){const e=t.oxw();t.hYB("value","",null==e.accInformations?null:e.accInformations.exp_month,"/",null==e.accInformations?null:e.accInformations.exp_year,""),t.Q6J("disabled",e.existAccount)}}function vt(i,d){1&i&&(t.TgZ(0,"span"),t._UZ(1,"i",34),t.qZA())}function Ct(i,d){1&i&&(t.TgZ(0,"span"),t._UZ(1,"i",35),t.qZA())}function yt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"button",36),t.NdJ("click",function(){t.CHM(e);const l=t.oxw(),c=t.MAs(60);return t.KtG(l.onConfiemDeleteCardNumberModal(c))}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Delete")," "))}function xt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"div",37)(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"button",38),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.onDecline())}),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"button",39),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.onConfirm())}),t._uU(8),t.ALo(9,"translate"),t.qZA()()}2&i&&(t.xp6(2),t.hij("",t.lcZ(3,3,"Confirm deletion"),"?"),t.xp6(3),t.Oqu(t.lcZ(6,5,"No")),t.xp6(3),t.Oqu(t.lcZ(9,7,"Yes")))}function Tt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"button",36),t.NdJ("click",function(l){t.CHM(e);const c=t.oxw();return t.KtG(c.onAddNewCard(l))}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Add")," "))}function bt(i,d){1&i&&(t.TgZ(0,"div",40)(1,"div",41)(2,"span"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"span"),t._UZ(6,"div",42),t.qZA()()()),2&i&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"Please wait...")," "))}let Et=(()=>{class i{constructor(e,r,l,c,_){this.walletService=e,this._location=r,this.modalService=l,this.router=c,this._cdref=_,this.sourceStripe={},this.cvc="",this.flagFailed=!1,this.driverCode=JSON.parse(localStorage.getItem("user")).login,this.timeExpiredDate={value:[Q.ou.local().minus({weeks:1}).toJSDate(),new Date],type:K.Nxg.Month},this.alerts=[{type:null,msg:null,timeout:0}],this.loading=!1}ngOnInit(){this.onGetStatusCreditCard(),this.initExpiredDate(),this.loading=!0,this.timerId=setTimeout(()=>{this.loading=!1,this.addCardElement()},window.stripe?200:3e3)}ngOnDestroy(){clearTimeout(this.timerId)}onConfiemDeleteCardNumberModal(e){this.modalRef=this.modalService.show(e,{class:"modal-sm"})}onConfirm(){this.message="Confirmed!",this.onDeleteCardNumber(),this.modalRef.hide()}onDecline(){this.message="Declined!",this.modalRef.hide()}onCancel(){this._location.back()}onDeleteCardNumber(){const e=this.accInformations,r={apiVersion:"1.0",userId:this.driverCode,customerId:this.stripeCustomerId,cardId:e.id,last4:e.last4,expYear:JSON.stringify(e.exp_year),expMonth:JSON.stringify(e.exp_month),brand:e.brand,funding:e.funding,country:e.country,remarks:""};this.accInformations.cardholderName===this.driverCode&&this.walletService.deleteCreditCards(r,this.driverCode).subscribe(()=>{this.alerts.push({type:"success",msg:"Credit/Debit Card successfully deleted.",timeout:b.W.shortTime,flag:"DELETED_CARD"})},l=>{const{error:c}=l;S.Z.isNotNull(c.status)&&this.alerts.push({type:"danger",msg:"Delete Card Number failed: "+c.status+", "+c.message+"Please try again!",timeout:b.W.longTime})})}changeStartDate(e){Array.isArray(e)||(this.timeExpiredDate=e,this.sourceStripe.exp_year=U(e.value[0],"DD/MM/YYYY").format("YYYY"),this.sourceStripe.exp_month=U(e.value[0],"DD/MM/YYYY").format("MM"))}onAddNewCard(e){window.stripe?(e.preventDefault(),this.loading=!0,window.stripe.createToken(this.cardTemplate).then(r=>{if(this.loading=!1,r.error)this.alerts.push({type:"danger",msg:r.error.message,timeout:b.W.longTime});else{const{card:l}=r.token,{id:c,last4:_,exp_year:B,exp_month:z,brand:Nt,funding:Yt,country:Lt}=l,Rt={apiVersion:"1.0",userId:this.driverCode,tokCard:r.token.id,customerId:this.stripeCustomerId,cardId:c,last4:_,expYear:JSON.stringify(B),expMonth:JSON.stringify(z),brand:Nt,funding:Yt,country:Lt,remarks:""};this.walletService.addCreditCards(Rt).subscribe(()=>{this.loading=!1,this.alerts.push({type:"success",msg:"Credit/Debit Card successfully added.",timeout:b.W.shortTime,flag:"ADD_CARD"}),this._cdref.detectChanges()},Jt=>{const{error:k}=Jt;this.loading=!1,S.Z.isNotNull(k.status)&&this.alerts.push({type:"danger",msg:"Add Card Number failed: "+k.status+", "+k.message+" Please try again!",timeout:b.W.longTime}),this._cdref.detectChanges()})}console.log(r)})):console.log("Oops! Stripe did not initialize properly.")}onClosed(e){("ADD_CARD"===e.flag||"DELETED_CARD"===e.flag)&&this.router.navigate(["/my-account/billing-history"])}onAddNewCardOldMethod(){this.sourceStripe.number=this.cardNumber.elementRef.nativeElement.previousElementSibling.value;let e={"card[number]":this.sourceStripe.number,"card[exp_month]":this.sourceStripe.exp_month?this.sourceStripe.exp_month:U(this.timeExpiredDate.value[0],"DD/MM/YYYY").format("MM"),"card[exp_year]":this.sourceStripe.exp_year?this.sourceStripe.exp_year:U(this.timeExpiredDate.value[0],"DD/MM/YYYY").format("YYYY"),"card[cvc]":this.cvc};if(""===e["card[number]"])return void this.alerts.push({type:"warning",msg:"Please enter a valid credit card number",timeout:b.W.longTime});let r=[];for(const c in e)if(e.hasOwnProperty(c)){const _=e[c];let B=encodeURIComponent(c),z=encodeURIComponent(_);r.push(B+"="+z)}let l=r.join("&");this.walletService.addCardNumberStepOne(l).pipe((0,G.b)(c=>this.walletService.addCardNumberStepTwo(this.stripeCustomerId,c.id))).subscribe(()=>{this.alerts.push({type:"success",msg:"You have successfully added the credit card",timeout:b.W.longTime}),this.router.navigate(["/my-account/billing-history"])},c=>{const{error:_}=c;S.Z.isNotNull(_.status)&&this.alerts.push({type:"danger",msg:"Add Card Number failed: "+_.status+", "+_.message+" Please try again!",timeout:b.W.longTime})})}onGetAccInformations(){const e=JSON.parse(localStorage.getItem("user")).accountId;this.walletService.getAccInformations(e).pipe((0,lt.b)(r=>this.stripeCustomerId=r.stripeCustomerId),(0,G.b)(r=>this.walletService.getCardDetail(r.stripeCustomerId))).subscribe(r=>{r.data&&r.data.length>0&&(this.accInformations=r)})}onGetStatusCreditCard(){this.walletService.getStatusCreditCard(this.driverCode).subscribe(e=>{e.cardholderName===this.driverCode?(this.accInformations=e,this.accInformations.exp_month=U(this.accInformations.expiryDate).format("MM"),this.accInformations.exp_year=U(this.accInformations.expiryDate).format("YYYY"),this.existAccount=!0):this.existAccount=!1},e=>this.existAccount=!1)}initExpiredDate(){this.timeExpiredDate={value:[Q.ou.local().plus({month:1}).toJSDate(),new Date],type:K.Nxg.Month}}addCardElement(){const e={base:{color:"#575962",fontSize:"16px","::placeholder":{color:"#9699a2"}}},r=window.stripe.elements();this.cardTemplate=r.create("cardNumber",{style:e,placeholder:"Input your card number"});const l=r.create("cardExpiry",{style:e,placeholder:"01 / 19"}),c=r.create("cardCvc",{style:e,placeholder:"123"});this.cardNumberElementRef?.nativeElement&&this.cardTemplate.mount(this.cardNumberElementRef?.nativeElement),this.cardExpiryElementRef?.nativeElement&&l.mount(this.cardExpiryElementRef?.nativeElement),this.cardCVCElementRef?.nativeElement&&c.mount(this.cardCVCElementRef?.nativeElement)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(L.X),t.Y36(g.Ye),t.Y36(T.tT),t.Y36(o.F0),t.Y36(t.sBO))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-card"]],viewQuery:function(e,r){if(1&e&&(t.Gf(pt,5),t.Gf(mt,5),t.Gf(ut,5),t.Gf(gt,5)),2&e){let l;t.iGM(l=t.CRH())&&(r.cardNumber=l.first),t.iGM(l=t.CRH())&&(r.cardNumberElementRef=l.first),t.iGM(l=t.CRH())&&(r.cardExpiryElementRef=l.first),t.iGM(l=t.CRH())&&(r.cardCVCElementRef=l.first)}},decls:63,vars:24,consts:[[1,"m-content","p-0"],[1,"col-sm-12"],[1,"row"],[1,"col-sm-6","text-center","mx-auto"],["class","mt-3 mt-3",3,"hidden",4,"ngFor","ngForOf"],[1,"m-form","m-form--fit","m-form--label-align-right"],[1,""],[1,"m-portlet__body","pt-0","mb-5"],[1,"col-lg-10","mx-auto"],[1,"row","form-group","m-form__group"],[1,"col-form-label","col-lg-4","col-sm-12"],[1,"m--font-danger"],[1,"col-lg-8","col-xl-5","col-sm-12"],[4,"ngIf"],[3,"hidden"],[1,"ant-input","ant-input-lg","custom-ant-input-lg"],["cardNumberElementRef",""],[1,"row","my-3"],["nz-input","","type","text","name","",3,"disabled","value",4,"ngIf"],["cardExpiryElementRef",""],[1,"row",3,"hidden"],["cardCVCElementRef",""],[1,"row","mt-3"],[1,"col-lg-8","col-sm-12"],[1,"m-portlet__foot","bg-light-gray","px-0"],[1,"m-form__actions","m-form__actions--right","py-0"],["nz-button","","nzType","primary","nzSize","large","nzGhost","",1,"btn-form-ops",3,"click"],["nz-button","","nzType","primary","nzSize","large","class","btn-form-ops m--margin-left-30",3,"click",4,"ngIf"],["templateConfirmDeleteCard",""],["class","m-blockui-loading",4,"ngIf"],[1,"mt-3","mt-3",3,"hidden"],[3,"type","dismissOnTimeout","onClosed"],["nz-input","","type","text","placeholder","","name","",3,"value","disabled"],["nz-input","","type","text","name","",3,"disabled","value"],[1,"la","la-cc-visa","font-size-3rem","wallet-visa-ic"],[1,"la","la-cc-mastercard","font-size-3rem","wallet-mastercard-ic"],["nz-button","","nzType","primary","nzSize","large",1,"btn-form-ops","m--margin-left-30",3,"click"],[1,"modal-body","text-center"],["nz-button","","nzType","primary","nzSize","large","nzGhost","","type","button",3,"click"],["nz-button","","nzType","primary","nzSize","large","type","button",1,"mgl16",3,"click"],[1,"m-blockui-loading"],[1,"m-blockui"],[1,"m-loader","m-loader--brand"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t.YNc(4,ht,3,4,"div",4),t.qZA()()(),t.TgZ(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",2)(9,"div",8)(10,"div",9)(11,"label",10)(12,"span",11),t._uU(13,"*"),t.qZA(),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"div",12),t.YNc(17,ft,2,2,"ng-container",13),t.TgZ(18,"div",14),t._UZ(19,"div",15,16),t.qZA()()()()(),t.TgZ(21,"div",17)(22,"div",8)(23,"div",9)(24,"label",10)(25,"span",11),t._uU(26,"*"),t.qZA(),t._uU(27),t.ALo(28,"translate"),t.qZA(),t.TgZ(29,"div",12),t.YNc(30,_t,1,3,"input",18),t.TgZ(31,"div",14),t._UZ(32,"div",15,19),t.qZA()()()()(),t.TgZ(34,"div",20)(35,"div",8)(36,"div",9)(37,"label",10)(38,"span",11),t._uU(39,"*"),t.qZA(),t._uU(40),t.ALo(41,"translate"),t.qZA(),t.TgZ(42,"div",12)(43,"div",14),t._UZ(44,"div",15,21),t.qZA()()()()(),t.TgZ(46,"div",22)(47,"div",8)(48,"div",9),t._UZ(49,"label",10),t.TgZ(50,"div",23),t.YNc(51,vt,2,0,"span",13),t.YNc(52,Ct,2,0,"span",13),t.qZA()()()()(),t.TgZ(53,"div",24)(54,"div",25)(55,"button",26),t.NdJ("click",function(){return r.onCancel()}),t._uU(56),t.ALo(57,"translate"),t.qZA(),t.YNc(58,yt,3,3,"button",27),t.YNc(59,xt,10,9,"ng-template",null,28,t.W1O),t.YNc(61,Tt,3,3,"button",27),t.qZA()()()()(),t.YNc(62,bt,7,3,"div",29)),2&e&&(t.xp6(4),t.Q6J("ngForOf",r.alerts),t.xp6(10),t.hij(" ",t.lcZ(15,16,"Credit/Debit Card"),": "),t.xp6(3),t.Q6J("ngIf",r.existAccount),t.xp6(1),t.Q6J("hidden",r.existAccount),t.xp6(9),t.hij(" ",t.lcZ(28,18,"Expiry Date"),": "),t.xp6(3),t.Q6J("ngIf",r.existAccount),t.xp6(1),t.Q6J("hidden",r.existAccount),t.xp6(3),t.Q6J("hidden",r.existAccount),t.xp6(6),t.hij(" ",t.lcZ(41,20,"CVV/CVC"),": "),t.xp6(3),t.Q6J("hidden",r.existAccount),t.xp6(8),t.Q6J("ngIf","Visa"===(null==r.accInformations?null:r.accInformations.cardType)||!r.existAccount),t.xp6(1),t.Q6J("ngIf","MasterCard"===(null==r.accInformations?null:r.accInformations.cardType)||!r.existAccount),t.xp6(4),t.hij(" ",t.lcZ(57,22,"Cancel")," "),t.xp6(2),t.Q6J("ngIf",r.existAccount),t.xp6(3),t.Q6J("ngIf",!r.existAccount),t.xp6(1),t.Q6J("ngIf",r.loading))},dependencies:[g.sg,g.O5,ct.Zp,W.ix,w.w,dt.dQ,D.wx,N.X$],styles:[".font-size-3rem[_ngcontent-%COMP%]{font-size:3rem}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;appearance:none;margin:0}input[_ngcontent-%COMP%]{-moz-appearance:textfield}.custom-ant-input-lg[_ngcontent-%COMP%]{height:40px;padding-top:10px}"]}),i})();function Mt(i,d){if(1&i&&(t.TgZ(0,"div",16)(1,"alert",17),t._uU(2),t.qZA()()),2&i){const e=d.$implicit;t.Q6J("hidden",!e.type),t.xp6(1),t.Q6J("type",e.type)("dismissOnTimeout",e.timeout),t.xp6(1),t.Oqu(e.msg)}}function At(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"div",18)(1,"button",19),t.NdJ("click",function(){const c=t.CHM(e).$implicit,_=t.oxw();return t.KtG(_.onSelectTopup(c.id))}),t._uU(2),t.qZA()()}if(2&i){const e=d.$implicit;t.xp6(1),t.MGl("id","topup-",e.id,""),t.xp6(1),t.hij(" $",e.packAmount/100," ")}}let Zt=(()=>{class i{constructor(e,r){this.walletService=e,this._location=r,this.alerts=[{type:null,msg:null,timeout:0}]}ngOnInit(){this.onGetCreditPacks()}onGetCreditPacks(){this.walletService.getCreditPacks().subscribe(e=>{this.creditPacks=e})}onSelectTopup(e){const r=document.getElementById(`topup-${e}`);if(Object.assign(r.style,{backgroundColor:"#fee4e3",color:"#E25C75"}),this.selectedTopupId&&e!==this.selectedTopupId){const l=document.getElementById(`topup-${this.selectedTopupId}`);Object.assign(l.style,{backgroundColor:"#eaeaea",color:"#7a7d84"})}this.selectedTopupId=e}onCancel(){this._location.back()}onSubmitTopup(){const e=JSON.parse(localStorage.getItem("user")).accountId,l={id:JSON.parse(localStorage.getItem("user")).id,creditPackId:this.selectedTopupId,paymentGateWay:"stripe"};this.selectedTopupId&&this.walletService.submitTopupPayment(e,l).subscribe(c=>{this.alerts.push(c&&"Top Up Limit Reached"===c.msg?{type:"warning",msg:"Topup Payment "+c.msg,timeout:b.W.middleTime}:{type:"success",msg:"Topup Payment's submit successfully",timeout:b.W.middleTime})},c=>{const{error:_}=c;S.Z.isNotNull(_.status)&&this.alerts.push({type:"danger",msg:"Topup Payment's submit failed: "+_.status+", "+_.message+"Please try again !",timeout:b.W.middleTime})})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(L.X),t.Y36(g.Ye))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-topup"]],decls:23,vars:3,consts:[[1,"m-content","p-0"],[1,"col-md-12"],[1,"row"],[1,"col-md-4","mx-auto"],["class","mt-3 mt-3",3,"hidden",4,"ngFor","ngForOf"],[1,"m-form","m-form--fit","m-form--label-align-right"],[1,""],[1,"m-portlet__body","pt-0","mb-5"],[1,"col-md-12","text-center"],[1,"row","mt-3","mb-5"],[1,"row","wrapper-topup"],["class","col-md-2",4,"ngFor","ngForOf"],[1,"m-portlet__foot","bg-light-gray","px-0"],[1,"m-form__actions","m-form__actions--right","py-0"],[1,"btn","btn-outline-main",3,"click"],[1,"btn","btn-main","m--margin-left-30",3,"disabled","click"],[1,"mt-3","mt-3",3,"hidden"],[3,"type","dismissOnTimeout"],[1,"col-md-2"],[1,"topup-circle",3,"id","click"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t.YNc(4,Mt,3,4,"div",4),t.qZA()()(),t.TgZ(5,"form",5)(6,"span"),t._uU(7,"Topup"),t.qZA(),t.TgZ(8,"div",6)(9,"div",7)(10,"div",2)(11,"p",8),t._uU(12," Choose your topup amount "),t.qZA()(),t.TgZ(13,"div",9)(14,"div",1)(15,"div",10),t.YNc(16,At,3,2,"div",11),t.qZA()()()(),t.TgZ(17,"div",12)(18,"div",13)(19,"button",14),t.NdJ("click",function(){return r.onCancel()}),t._uU(20," Cancel "),t.qZA(),t.TgZ(21,"button",15),t.NdJ("click",function(){return r.onSubmitTopup()}),t._uU(22," Submit "),t.qZA()()()()()()),2&e&&(t.xp6(4),t.Q6J("ngForOf",r.alerts),t.xp6(12),t.Q6J("ngForOf",r.creditPacks),t.xp6(5),t.Q6J("disabled",!r.selectedTopupId))},dependencies:[g.sg,E._Y,E.JL,E.F,D.wx],styles:[".wrapper-topup[_ngcontent-%COMP%]{justify-content:center}.wrapper-topup[_ngcontent-%COMP%]   .topup-circle[_ngcontent-%COMP%]{border-radius:120px;background-color:#eaeaea;padding:20px;width:120px;font-weight:700;color:#7a7d84;font-size:18px;height:120px;text-align:center;border:0px solid #f7f7f7}.wrapper-topup[_ngcontent-%COMP%]   .topup-circle[_ngcontent-%COMP%]:hover{background-color:#fee4e3;color:#e25c75;cursor:pointer}"]}),i})();var Ot=n(98731),Pt=n(19832),It=n(44466),Dt=n(75191),$=n(3116);function j(i){return new Pt.w(i)}const Ut=[{path:"",component:a.f,children:[{path:"",component:at,children:[{path:"",redirectTo:"billing-history",pathMatch:"full"},{path:"billing-history",component:st.Z,data:{breadcrumb:{label:"Billing History"}}},{path:"card",component:Et,data:{breadcrumb:{label:"Card"}}},{path:"topup",component:Zt,data:{breadcrumb:{label:"Topup"}}},{path:"billing-detail",component:Ot.d,data:{breadcrumb:{label:"Billing Detail"}}}]}]}];let St=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[v.k,f.e,M.C,x.I,y.x,p.F,s.f,P.I,O.z,L.X,Dt.B],imports:[g.ez,It.m,E.u5,o.Bz.forChild(Ut),I.x,m.D,Y.mr,h.k,H.S,T.zk.forRoot(),u.A0,X.IJ,Z.kn,V.E7,F.a,D.nM.forRoot(),J.UU.forRoot(),N.aw.forChild({loader:{provide:N.Zw,useFactory:j,deps:[C.eN]}}),$.b,o.Bz,F.a,$.b]}),i})()}}]);